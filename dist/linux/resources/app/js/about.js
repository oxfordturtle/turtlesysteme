!function(e){var t={};function a(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,a),r.l=!0,r.exports}a.m=e,a.c=t,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)a.d(n,r,function(t){return e[t]}.bind(null,r));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=13)}([function(e,t,a){"use strict";a.d(t,"b",function(){return r}),a.d(t,"a",function(){return o});const n=(e,t,a)=>({code:e,args:t,str:a}),r=[n(0,0,"NULL"),n(1,0,"DUPL"),n(2,0,"SWAP"),n(3,0,"ROTA"),n(4,0,"INCR"),n(5,0,"DECR"),void 0,void 0,n(8,0,"NOT"),n(9,0,"AND"),n(10,0,"OR"),n(11,0,"XOR"),void 0,void 0,void 0,void 0,n(16,0,"NEG"),n(17,0,"ABS"),n(18,0,"SIGN"),n(19,0,"RAND"),void 0,void 0,void 0,void 0,n(24,0,"PLUS"),n(25,0,"SUBT"),n(26,0,"MULT"),n(27,0,"DIVR"),n(28,0,"DIV"),n(29,0,"MOD"),void 0,void 0,n(32,0,"DIVM"),n(33,0,"SQRT"),n(34,0,"HYP"),n(35,0,"ROOT"),n(36,0,"POWR"),n(37,0,"LOG"),n(38,0,"ALOG"),n(39,0,"LN"),n(40,0,"EXP"),n(41,0,"SIN"),n(42,0,"COS"),n(43,0,"TAN"),n(44,0,"ASIN"),n(45,0,"ACOS"),n(46,0,"ATAN"),n(47,0,"PI"),n(48,0,"CTOS"),n(49,0,"ITOS"),n(50,0,"HEXS"),n(51,0,"SVAL"),n(52,0,"QTOS"),n(53,0,"QVAL"),n(54,0,"SCAT"),n(55,0,"SLEN"),n(56,0,"CASE"),n(57,0,"COPY"),n(58,0,"DELS"),n(59,0,"INSS"),n(60,0,"POSS"),n(61,0,"REPL"),void 0,void 0,n(64,0,"EQAL"),n(65,0,"NOEQ"),n(66,0,"LESS"),n(67,0,"MORE"),n(68,0,"LSEQ"),n(69,0,"MREQ"),n(70,0,"MAXI"),n(71,0,"MINI"),n(72,0,"SEQL"),n(73,0,"SNEQ"),n(74,0,"SLES"),n(75,0,"SMOR"),n(76,0,"SLEQ"),n(77,0,"SMEQ"),n(78,0,"SMAX"),n(79,0,"SMIN"),n(80,1,"LDIN"),n(81,1,"LDVG"),n(82,2,"LDVV"),n(83,2,"LDVR"),n(84,1,"LDAG"),n(85,2,"LDAV"),void 0,n(87,-1,"LSTR"),n(88,0,"LDMT"),void 0,void 0,void 0,void 0,void 0,void 0,void 0,n(96,2,"ZERO"),n(97,1,"STVG"),n(98,2,"STVV"),n(99,2,"STVR"),void 0,void 0,void 0,void 0,n(104,0,"STMT"),void 0,void 0,void 0,void 0,void 0,void 0,void 0,n(112,0,"LPTR"),n(113,0,"SPTR"),n(114,0,"CPTR"),n(115,0,"ZPTR"),void 0,void 0,void 0,void 0,n(120,0,"TEST"),n(121,0,"CSTR"),void 0,void 0,void 0,void 0,void 0,void 0,n(128,1,"JUMP"),n(129,1,"IFNO"),n(130,0,"HALT"),void 0,void 0,void 0,void 0,void 0,n(136,1,"SUBR"),n(137,0,"RETN"),void 0,void 0,n(140,1,"PSSR"),n(141,0,"PLSR"),n(142,0,"PSRJ"),n(143,0,"PLRJ"),n(144,2,"MEMC"),n(145,1,"MEMR"),n(146,0,"HFIX"),n(147,0,"HCLR"),n(148,0,"HRST"),void 0,void 0,void 0,n(152,-2,"NEWT"),n(153,-2,"OLDT"),n(154,-2,"RNDC"),n(155,-2,"TEXL"),n(156,-2,"UPPC"),n(157,-2,"LOWC"),n(158,-2,"LEFS"),n(159,-2,"RGTS"),n(160,0,"PNUP"),n(161,0,"PNDN"),n(162,0,"UDAT"),n(163,0,"NDAT"),n(164,0,"KECH"),void 0,n(166,0,"OUTP"),n(167,0,"CONS"),n(168,0,"TRAC"),n(169,0,"MEMW"),n(170,0,"DUMP"),n(171,-2,"SVD0"),n(172,-2,"BOOL"),n(173,-2,"ILIN"),void 0,void 0,n(176,0,"TIME"),n(177,0,"TSET"),n(178,0,"WAIT"),n(179,0,"TDET"),void 0,void 0,void 0,void 0,n(184,0,"INPT"),n(185,0,"ICLR"),n(186,0,"BUFR"),n(187,0,"READ"),n(188,0,"RDLN"),n(189,0,"PRNT"),n(190,0,"TEXT"),n(191,0,"NEWL"),n(192,0,"FDIR"),n(193,0,"OPEN"),n(194,0,"CLOS"),n(195,0,"FPTR"),n(196,0,"FBEG"),n(197,0,"EOF"),n(198,0,"FRDS"),n(199,0,"FRLN"),n(200,0,"FWRS"),n(201,0,"FWNL"),void 0,void 0,void 0,void 0,void 0,void 0,n(208,0,"CANV"),n(209,0,"RESO"),n(210,0,"PIXC"),n(211,0,"PIXS"),n(212,0,"ANGL"),n(213,0,"CURS"),void 0,void 0,n(216,0,"HOME"),n(217,0,"SETX"),n(218,0,"SETY"),n(219,0,"SETD"),n(220,0,"THIK"),n(221,0,"COLR"),n(222,0,"RGB"),n(223,0,"MIXC"),n(224,0,"TOXY"),n(225,0,"MVXY"),n(226,0,"DRXY"),n(227,0,"FWRD"),n(228,0,"BACK"),n(229,0,"LEFT"),n(230,0,"RGHT"),n(231,0,"TURN"),void 0,void 0,void 0,void 0,n(236,0,"RMBR"),n(237,0,"FRGT"),void 0,void 0,n(240,0,"POLY"),n(241,0,"PFIL"),n(242,0,"CIRC"),n(243,0,"BLOT"),n(244,0,"ELPS"),n(245,0,"EBLT"),n(246,0,"BOX"),void 0,n(248,0,"BLNK"),void 0,void 0,void 0,n(252,0,"RCOL"),n(253,0,"FILL"),void 0,n(255,0,"MXIN")],o=r.filter(e=>void 0!==e).reduce((e,t)=>(e[t.str.toLowerCase()]=t.code,e),{})},function(e,t,a){"use strict";a.d(t,"a",function(){return n}),a.d(t,"c",function(){return r}),a.d(t,"d",function(){return o}),a.d(t,"f",function(){return s}),a.d(t,"e",function(){return i}),a.d(t,"b",function(){return l});const n=(e,t={})=>{const a=document.createElement(e);return Object.keys(t).forEach(e=>{switch(e){case"classes":t.classes.forEach(e=>a.classList.add(e));break;case"content":"string"==typeof t.content?a.innerHTML=t.content:t.content.forEach(e=>{"string"==typeof e?a.appendChild(document.createTextNode(e)):a.appendChild(e)});break;case"value":a.value=t.value;break;case"on":t.on.forEach(e=>{a.addEventListener(e.type,e.callback)});break;default:a.setAttribute(e,t[e])}}),a},r=e=>`#${o(e.toString(16))}`,o=e=>e.length<6?o(`0${e}`):e,s=(e,t)=>n("div",{classes:["tsx-tabs",e],content:[u(t),m(t)]}),i=e=>{c(document.querySelector(`[data-target="${e}"]`)),c(document.getElementById(e))},l=({url:e,success:t,error:a})=>{const n=new window.XMLHttpRequest;n.onreadystatechange=(()=>{4===n.readyState&&(200===n.status?t(n.responseText):a(n.status))}),n.open("GET",e),n.send()},c=e=>{if(e){Array.from(e.parentElement.children).forEach(e=>e.classList.remove("active")),e.classList.add("active")}},d=e=>n("a",{classes:e.active?["tsx-tab","active"]:["tsx-tab"],content:e.label,"data-target":e.label.replace(/ /g,""),on:[{type:"click",callback:e=>{c(e.currentTarget),c(document.getElementById(e.currentTarget.getAttribute("data-target")))}}]}),u=e=>n("nav",{classes:["tsx-tab-list"],content:e.map(d)}),p=e=>n("div",{classes:e.active?["tsx-tab-pane","active"]:["tsx-tab-pane"],content:e.content,id:e.label.replace(/ /g,"")}),m=e=>n("div",{classes:["tsx-tab-panes"],content:e.map(p)})},,function(e,t,a){"use strict";var n=a(1),r=a(4),o=a(7),s=a(5);const i=(e,t)=>` ${t.line.toString(10)}`,l=(e,t)=>e+t.count,c=(e,t,a)=>{const n=a.expressions.filter(((e,t,a)=>{const n=a.name||a.names[e];return t.filter(e=>e.content===n).length>0}).bind(null,e,t)).map(((e,t,a)=>{const n=a.name||a.names[e],r=t.filter(e=>e.content===n);return{name:n,level:a.level+1,count:r.length,lines:r.reduce(i,"").trim()}}).bind(null,e,t));return{title:a.title,expressions:n,total:n.reduce(l,0)}};var d=(e,t)=>{const a=t?new Error(e.replace("{lex}",`"${t.content}"`)):new Error(e);return a.lexeme=t,a.type="Compiler",a},u=a(6);const p=["Unterminated comment.","Unterminated string.","Binary numbers in Turtle BASIC begin with '%'.","Binary numbers in Turtle Pascal begin with '%'.","Binary numbers in Turtle Python begin with '0b'.","Turtle BASIC does not support octal numbers.","Octal numbers in Turtle Pascal begin with '&'","Octal numbers in Turtle Python begin with '0o'","Hexadecimal numbers in Turtle BASIC begin with '&'","Hexadecimal numbers in Turtle Pascal begin with '$'","Hexadecimal numbers in Turtle Python begin with '0x'","The Turtle System does not support real numbers.","Illegal character in this context."],m=(e,t,a,n)=>({type:h(e.type,e.content),content:"Pascal"===n?e.content.toLowerCase():e.content,value:g(e.type,e.content,n),line:t,offset:a}),h=(e,t)=>{switch(e){case"binary":case"octal":case"hexadecimal":case"decimal":return"integer";case"command":case"colour":case"custom":case"variable":return"identifier";default:return e}},g=(e,t,a)=>{switch(e){case"operator":switch(t.toLowerCase()){case"+":return"plus";case"-":return"subt";case"*":return"mult";case"/":return"divr";case"div":case"//":return"div";case"mod":case"%":return"mod";case"=":case"==":return"eqal";case"<>":case"!=":return"noeq";case"<=":return"lseq";case">=":return"mreq";case"<":return"less";case">":return"more";case"not":return"not";case"and":return"and";case"or":return"or";case"xor":case"eor":return"xor";default:return null}case"string":return t.slice(1,-1).replace(/''/g,"'").replace(/\\('|")/g,"$1");case"boolean":return"true"===t.toLowerCase()?-1:0;case"binary":return"Python"===a?parseInt(t.slice(2),2):parseInt(t.slice(1),2);case"octal":return"Python"===a?parseInt(t.slice(2),8):parseInt(t.slice(1),8);case"hexadecimal":return"Python"===a?parseInt(t.slice(2),16):parseInt(t.slice(1),16);case"decimal":return parseInt(t);case"turtle":return["x","y","d","t","c"].indexOf(t[4].toLowerCase())+1;default:return null}};var b=(e,t,a)=>{if("null"!==e&&t!==e&&("string"!==e||"char"!==t)&&("boolint"!==e||"boolean"!==t&&"integer"!==t)&&("boolint"!==t||"boolean"!==e&&"integer"!==e))throw d(`Type error: '${e}' expected but '${t}' found.`,a)};const f=e=>e.parent?f(e.parent):e,y=(e,t,a)=>E(e,"constants",t,a),x=(e,t,a)=>{const n=("BASIC"===a?["TURTX%","TURTY%","TURTD%","TURTT%","TURTC%"]:["turtx","turty","turtd","turtt","turtc"]).indexOf(t)+1,r=e.index>0&&e.globals.indexOf(t)>-1;return n>0?{turtle:n,fulltype:{type:"integer"}}:E(r?f(e):e,"variables",t,a)},w=(e,t)=>r.a.find(T.bind(null,S(e),t)),v=(e,t,a)=>E(e,"subroutines",t,a),k=(e,t,a)=>v(e,t,a)||((e,t)=>s.b.find(T.bind(null,S(e),t)))(t,a),T=(e,t,a)=>(a.name||a.names[t])===e,E=(e,t,a,n)=>e.parent?e[t].find(T.bind(null,a,n))||E(e.parent,t,a,n):e[t].find(T.bind(null,a,n)),S=e=>e.replace(/gray/,"grey").replace(/GRAY/,"GREY").replace(/^COLOR$/,"COLOUR").replace(/^color$/,"colour");var R=a(0);const O=(e,t)=>e.slice(0,-1).concat([e[e.length-1].concat(t[0])]).concat(t.slice(1)),L=(e,t,a)=>{const n=O(e,t.pcode),r=O(n,[R.a[a]]);return Object.assign(t,{pcode:r})},P=(e,t)=>"string"===e?[R.a.lstr,t.length].concat(Array.from(t).map(e=>e.charCodeAt(0))):[R.a.ldin,t],C=e=>e.turtle?[R.a.ldin,0,R.a.lptr,R.a.ldin,e.turtle,R.a.plus,R.a.lptr]:0===e.routine.index?[R.a.ldvg,e.routine.turtleAddress+5+e.index]:e.byref?[R.a.ldvr,e.routine.index+9,e.index]:[R.a.ldvv,e.routine.index+9,e.index],I=(e,t)=>e.turtle?[R.a.ldin,0,R.a.lptr,R.a.ldin,e.turtle,R.a.plus,R.a.sptr]:0===e.routine.index?"string"===e.fulltype.type?[R.a.ldvg,e.routine.turtleAddress+5+e.index,R.a.cstr]:[R.a.stvg,e.routine.turtleAddress+5+e.index]:"string"===e.fulltype.type?[R.a.ldvv,e.routine.index+9,e.index,R.a.cstr,R.a.hclr]:e.byref&&!t?[R.a.stvr,e.routine.index+9,e.index]:[R.a.stvv,e.routine.index+9,e.index],M=e=>[R.a[e]],A=(e,t,a)=>{const n=f(t).turtleAddress;switch(e.code){case R.a.newt:return[R.a.ldin,0,R.a.sptr];case R.a.oldt:return[R.a.ldin,n,R.a.ldin,0,R.a.sptr];case R.a.incr:case R.a.decr:return[R.a.dupl,R.a.lptr,e.code,R.a.swap,R.a.sptr];case R.a.rndc:return[R.a.rand,R.a.incr,R.a.rgb,R.a.colr];case R.a.rand:switch(a){case"BASIC":return[R.a.rand,R.a.incr];case"Pascal":return[R.a.rand];case"Python":return[R.a.swap,R.a.dupl,R.a.rota,R.a.incr,R.a.swap,R.a.subt,R.a.rand,R.a.plus]}break;case R.a.texl:return[R.a.text,R.a.newl];case R.a.uppc:return[R.a.ldin,1,R.a.case];case R.a.lowc:return[R.a.ldin,-1,R.a.case];case R.a.lefs:return[R.a.ldin,1,R.a.swap,R.a.copy];case R.a.rgts:return[R.a.swap,R.a.dupl,R.a.slen,R.a.incr,R.a.rota,R.a.subt,R.a.mxin,R.a.copy];case R.a.inss:switch(a){case"BASIC":case"Python":return[R.a.rota,R.a.rota,R.a.inss];case"Pascal":return[R.a.inss]}break;case R.a.poss:switch(a){case"BASIC":case"Python":return[R.a.swap,R.a.poss];case"Pascal":return[R.a.poss]}break;case R.a.svd0:return[R.a.ldin,0,R.a.sval];case R.a.bool:return[R.a.abs];case R.a.ilin:return[R.a.text,R.a.newl,R.a.rdln];case R.a.bufr:return[R.a.bufr,R.a.ldin,1,R.a.sptr,R.a.hfix];case void 0:return[R.a.subr,e.startLine];default:return[e.code]}},N=(e,t,a,n=[])=>{const r=n.length>0?2:1,o=[t.concat([R.a.ifno,a.length+e+r])],s=[[R.a.jump,a.length+n.length+e+r]];return n.length>0?o.concat(a).concat(s).concat(n):o.concat(a)},D=(e,t,a,n,r,o,s)=>{const i=s.length+e+4,l=[a,I(t).concat(n),C(t).concat([R.a[r],R.a.ifno,i])],c=[C(t).concat([R.a[o],R.a.jump,e+1])];return l.concat(s).concat(c)},F=(e,t,a)=>{const n=[t.concat([R.a.ifno,e])];return a.concat(n)},B=(e,t,a)=>{const n=[t.concat([R.a.ifno,a.length+e+2])],r=[[R.a.jump,e]];return n.concat(a).concat(r)},U=(e,t)=>{const a=G(e),n=z(e);return a.concat(t).concat(n)},G=e=>{const t=[[R.a.pssr,e.index]],a=t.concat($(e));return e.variables.length>0&&e.parameters.length>0?a.concat(W(e)):e.variables.length>0?a:t},q=e=>e.variables.filter(e=>"string"===e.fulltype.type),H=e=>{const t=e.routine.turtleAddress+5+e.index;return[R.a.ldag,t+2,R.a.stvg,t,R.a.ldin,e.length-1,R.a.stvg,t+1]},j=e=>{const t=e.routine.index+9,a=e.index;return[R.a.ldav,t,a+2,R.a.stvv,t,a,R.a.ldin,e.fulltype.length-1,R.a.stvv,t,a+1]},$=e=>{const t=[[R.a.memc,e.index+9,e.memoryNeeded],[R.a.ldav,e.index+9,1,R.a.ldin,e.memoryNeeded,R.a.zptr]];return q(e).length>0?t.concat(q(e).map(j)):t},W=e=>{const t=[];let a=e.parameters.length;for(;a>0;)a-=1,t.push(I(e.parameters[a]));return t},z=e=>{const t=e.index+9,a=f(e).resultAddress,n=[R.a.ldvg,t,R.a.stvg,a],r=[R.a.memr,t],o=[R.a.plsr,R.a.retn];return e.variables.length>0&&"function"===e.type?[n,r.concat(o)]:e.variables.length>0?[r.concat(o)]:[o]},Y=[R.a.home,R.a.ldin,2,R.a.thik,R.a.ldin,32,R.a.bufr,R.a.ldin,1,R.a.sptr,R.a.hfix,R.a.ldin,0,R.a.dupl,R.a.ldin,1e3,R.a.dupl,R.a.dupl,R.a.dupl,R.a.reso,R.a.canv],X=e=>{const t=[((e,t)=>[R.a.ldin,e,R.a.dupl,R.a.dupl,R.a.ldin,0,R.a.sptr,R.a.ldin,5,R.a.swap,R.a.sptr,R.a.incr,R.a.ldin,t+5,R.a.zptr,R.a.ldin,e+t+5,R.a.stmt])(e.turtleAddress,e.memoryNeeded),Y];return q(e).length>0?t.concat(q(e).map(H)):t},V=(e,t,a,n)=>{const o=((e,t)=>r.e.find(T.bind(null,e,t)))(e[t].content,n);if(o)return b(a,o.type,e[t]),{type:"integer",lex:t+1,pcode:[(e=>e.value<0?P("integer",e.value):P("integer",e.value).concat(R.a.inpt))(o)]}},K=(e,t,a,n,r)=>{const o=["eqal","less","lseq","more","mreq","noeq"];"boolean"===n&&(n="null");let s=J(e,t,a,n,r);for(;e.lexemes[s.lex]&&o.indexOf(e.lexemes[s.lex].value)>-1;){let t=Z(e.lexemes[s.lex].value,s.type),a=J(e,s.lex+1,s.type,n,r);s=L(s.pcode,a,t)}return s},Q=(e,t,a,n)=>{const r=x(e,t,n);if(!r)throw d(`Variable "${t}" is not defined.`,e.lexemes[a]);if(!e.lexemes[a])throw d(`Variable "${t}" must be assigned a value.`,e.lexemes[a-1]);const o=K(e,a,"null",r.fulltype.type,n);return{lex:o.lex,pcode:O(o.pcode,[I(r)])}},_=(e,t,a,n=!0)=>{const r=k(e,e.lexemes[t].content,a);if(!r)throw d("{lex} is not defined.",e.lexemes[t]);if(n&&"procedure"!==r.type)throw d("{lex} is a function, not a procedure.",e.lexemes[t]);return 0===r.parameters.length?oe(e,t,r,a):se(e,t,r,a)},Z=(e,t)=>{return"string"===t||"char"===t?["seql","sles","sleq","smor","smeq","sneq","scat"][["eqal","less","lseq","more","mreq","noeq","plus"].indexOf(e)]:e},J=(e,t,a,n,r)=>{const o=["plus","subt","or","xor"];let s=ee(e,t,a,n,r);for(;e.lexemes[s.lex]&&o.indexOf(e.lexemes[s.lex].value)>-1;){let t=Z(e.lexemes[s.lex].value,s.type),a=ee(e,s.lex+1,s.type,n,r);s=L(s.pcode,a,t)}return s},ee=(e,t,a,n,r)=>{const o=["and","div","divr","mod","mult"];let s=te(e,t,a,n,r);for(;e.lexemes[s.lex]&&o.indexOf(e.lexemes[s.lex].value)>-1;){let t=Z(e.lexemes[s.lex].value,s.type),a=te(e,s.lex+1,s.type,n,r);s=L(s.pcode,a,t)}return s},te=(e,t,a,n,r)=>{switch(e.lexemes[t].type){case"operator":return ae(e,t,n,r)||(()=>{throw d("{lex} makes no sense here.",e.lexemes[t])})();case"boolean":case"char":case"integer":case"string":return((e,t,a)=>{const{type:n,value:r}=e[t];return b(a,n,e[t]),"char"===n&&"string"===a?{type:n,lex:t+1,pcode:[P(n,r),M("ctos")]}:{type:n,lex:t+1,pcode:[P(n,r)]}})(e.lexemes,t,n);case"keycode":case"query":return V(e.lexemes,t,n,r)||(()=>{throw d("{lex} is not a valid input code.",e.lexemes[t])})();case"turtle":case"identifier":return((e,t,a,n)=>{const{lexemes:r}=e,o=y(e,r[t].content,n);if(o)return b(a,o.type,r[t]),{type:o.type,lex:t+1,pcode:[P(o.type,o.value)]}})(e,t,n,r)||((e,t,a,n)=>{const{lexemes:r}=e,o=x(e,r[t].content,n);if(o)return b(a,o.fulltype.type,r[t]),{type:o.fulltype.type,lex:t+1,pcode:[C(o)]}})(e,t,n,r)||((e,t,a,n)=>{const{lexemes:r}=e,o=w(r[t].content,n);if(o)return b(a,"integer",r[t]),{type:"integer",lex:t+1,pcode:[P("integer",o.value)]}})(e,t,n,r)||ne(e,t,n,r)||(()=>{throw d("{lex} is not defined.",e.lexemes[t])})();default:return re(e,t,a,n,r)||(()=>{throw d("{lex} makes no sense here.",e.lexemes[t])})()}},ae=(e,t,a,n)=>{if("-"===e.lexemes[t].content||"not"===e.lexemes[t].value){const r="-"===e.lexemes[t].content?"integer":"boolint",o="-"===e.lexemes[t].content?[M("neg")]:[M("not")];b(a,"integer",e.lexemes[t]);const s=te(e,t+1,r,a,n);return Object.assign(s,{pcode:O(s.pcode,o)})}return null},ne=(e,t,a,n)=>{const r=k(e,e.lexemes[t].content,n);if(r){if("function"!==r.type)throw d("{lex} is a procedure, not a function.",e.lexemes[t]);b(a,r.returns,e.lexemes[t]);const o=_(e,t,n,!1);return r.code||o.pcode.push((e=>[R.a.ldvv,e,1])(r.resultAddress)),Object.assign(o,{type:r.returns})}return null},re=(e,t,a,n,r)=>{if("("===e.lexemes[t].content){const o=K(e,t+1,a,n,r);if(e.lexemes[o.lex]&&")"===e.lexemes[o.lex].content)return Object.assign(o,{lex:o.lex+1});throw d("Closing bracket missing.",e.lexemes[t-1])}return null},oe=(e,t,a,n)=>{if("Python"===n){if(!e.lexemes[t+1]||"("!==e.lexemes[t+1].content)throw d("Opening bracket missing after command {lex}.",e.lexemes[t]);if(!e.lexemes[t+2]||")"!==e.lexemes[t+2].content)throw d("Command {lex} takes no arguments.",e.lexemes[t-1]);return{lex:t+3,pcode:[A(a,e,n)]}}if(e.lexemes[t+1]&&"("===e.lexemes[t+1].content)throw d("Command {lex} takes no arguments.",e.lexemes[t]);return{lex:t+1,pcode:[A(a,e,n)]}},se=(e,t,a,n)=>{if(!e.lexemes[t+1]||"("!==e.lexemes[t+1].content)throw d("Opening bracket missing after command {lex}.",e.lexemes[t]);const r=ie(e,t+2,a,n),o=[A(a,e,n)];return Object.assign(r,{pcode:O(r.pcode,o)})},ie=(e,t,a,n)=>{const r=a.parameters.length;let o=0,s=[[]];for(;o<r&&")"!==e.lexemes[t].content;){let i=le(e,t,a,o,n);if(o+=1,t=i.lex,s=O(s,i.pcode),o<r){if(!e.lexemes[t]||","!==e.lexemes[t].content)throw d("Comma needed after parameter.",e.lexemes[t]);t+=1}}const i=a.name||a.names[n];if(o<r)throw d(`Not enough arguments given for command "${i}".`,e.lexemes[t]);if(","===e.lexemes[t].content)throw d(`Too many arguments given for command "${i}"`,e.lexemes[t]);if(")"!==e.lexemes[t].content)throw d(`Closing bracket missing after command "${i}"`,e.lexemes[t-1]);return{lex:t+1,pcode:s}},le=(e,t,a,n,r)=>{if(a.parameters[n].byref){let a=x(e,e.lexemes[t].content,r);if(!a)throw d("{lex} is not defined.}",e.lexemes[t]);return{lex:t+1,pcode:[(e=>e.turtle?[R.a.ldin,0,R.a.lptr,R.a.ldin,e.turtle,R.a.plus]:0===e.routine.index?[R.a.ldag,e.routine.turtleAddress+5+e.index]:[R.a.ldav,e.routine.index+9,e.index])(a)]}}const o=a.parameters[n].type||a.parameters[n].fulltype.type;return K(e,t,"null",o,r)},ce=(e,t)=>({language:t,name:e,index:0,indent:0,constants:[],variables:[],subroutines:[],lexemes:[],turtleAddress:null,memoryNeeded:null}),de=(e,t,a)=>({name:e,type:t,level:-1,index:null,indent:null,globals:[],nonlocals:[],constants:[],parameters:[],variables:[],parent:a,subroutines:[],lexemes:[],memoryNeeded:null}),ue=(e,t,a)=>({name:e,type:t,value:a}),pe=(e,t,a=!1)=>({name:e.content,lexeme:e,routine:t,byref:a,index:null,fulltype:null,private:null}),me=(e,t=null,a=null,n=null)=>"string"===e?{type:e,length:33,start:a,fulltype:n}:{type:e,length:t,start:a,fulltype:n};var he=e=>{const t=[];for(var a,n,r,o,s,i,l,c=0,u="start";c<e.length;)switch(u){case"start":if(a=!0,n=!1,r=!1,s=ce("!","BASIC"),t.push(s),"DEF"===e[c].content)throw d('Subroutines must be defined after program "END".',e[c]);u="DIM"===e[c].content?"dim":"prog";break;case"dim":break;case"prog":if("DIM"===e[c].content)throw d('"DIM" commands must occur at the top of the program.',e[c]);if("PRIVATE"===e[c].content)throw d("Private variables cannot be defined in the main program.",e[c]);if("LOCAL"===e[c].content)throw d("Local variables cannot be defined in the main program.",e[c]);if("DEF"===e[c].content)throw d('Subroutines must be defined after program "END".',e[c]);"END"===e[c].content?(a=!1,u="end"):("identifier"===e[c].type&&e[c+1]&&"="===e[c+1].content&&(ge(t[0],e[c].content)||((i=pe(e[c],t[0],!1)).fulltype=be(e[c].content),t[0].variables.push(i))),t[0].lexemes.push(e[c])),c+=1;break;case"end":if(e[c]){if("DEF"!==e[c].content){if(0===s.index)throw d('No program text can appear after program "END" (except subroutine definitions).',e[c]);throw d("No program text can appear after subroutine end (except further subroutine definitions).",e[c])}c+=1,u="def"}break;case"def":if(!e[c])throw d('"DEF" must be followed by a valid procedure or function name. (Procedure names must begin with "PROC", and function names must begin with "FN".)',e[c-1]);if(!fe(e[c].content))throw d('"DIM" commands can only occur within the main program. To declare a local or private array, use "LOCAL" or "PRIVATE" instead.',e[c]);if((s=de(e[c].content,fe(e[c].content,t[0]))).parent=t[0],t.push(s),t[0].subroutines.push(s),"procedure"===s.type?n=!0:(r=!0,i=pe({content:"result"},s),s.variables.push(i)),!e[c+1])throw d("No program text can appear after subroutine end (except further subroutine definitions).",e[c]);"("===e[c+=1].content?(c+=1,u="parameters"):u="variables";break;case"parameters":if(!e[c])throw d("Parameter name expected.",e[c-1]);if(o="RETURN"===e[c].content,!e[c="RETURN"===e[c].content?c+1:c])throw d("Parameter name expected.",e[c-1]);if("turtle"===e[c].type)throw d("{lex} is the name of a Turtle property, and cannot be used as a parameter name.",e[c]);if("identifier"!==e[c].type)throw d("{lex} is not a valid parameter name.",e[c]);if(!be(e[c].content))throw d('{lex} is not a valid parameter name. Integer parameters must end with "%", and string parameters must end with "$".',e[c]);if(ge(s,e[c].content))throw d("{lex} is already a parameter for this subroutine.",e[c]);if((i=pe(e[c],s,o)).fulltype=be(e[c].content),s.parameters.push(i),s.variables.push(i),!e[c+=1])throw d("Closing bracket needed after parameters.",e[c-1]);if("identifier"===e[c].type)throw d("Comma needed after parameter.",e[c]);if(")"===e[c].content)u="variables";else if(","!==e[c].content)throw d("Closing bracket needed after parameters.",e[c]);c+=1;break;case"variables":if(!e[c])throw d("Subroutine definition must be followed by some commands.",e[c-1]);switch(e[c].content){case"DIM":throw d('"DIM" commands can only occur within the main program. To declare a local or private array, use "LOCAL" or "PRIVATE" instead.',e[c]);case"PRIVATE":c+=1,u="private";break;case"LOCAL":c+=1,u="local";break;default:u="subroutine"}break;case"private":if(!e[c])throw d("Variable name expected.",e[c-1]);if("turtle"===e[c].type)throw d("{lex} is the name of a Turtle property, and cannot be used as a variable name.",e[c]);if("identifier"!==e[c].type)throw d("{lex} is not a valid variable name.",e[c]);if(!be(e[c].content))throw d('{lex} is not a valid variable name. Integer variables must end with "%", and string variables must end with "$".',e[c]);if(ge(s,e[c].content))throw d("{lex} is already a variable in the current scope.",e[c]);if((i=pe(e[c],t[0])).fulltype=be(e[c].content),i.private=s,t[0].variables.push(i),!e[c+=1])throw d("subNoEnd",e[c-1]);","===e[c].content?c+=1:u="variables";break;case"local":if(!e[c])throw d("Variable name expected.",e[c-1]);if("turtle"===e[c].type)throw d("{lex} is the name of a Turtle property, and cannot be used as a variable name.",e[c]);if("identifier"!==e[c].type)throw d("{lex} is not a valid variable name.",e[c]);if(!be(e[c].content))throw d('{lex} is not a valid variable name. Integer variables must end with "%", and string variables must end with "$".',e[c]);if(ge(s,e[c].content))throw d("{lex} is already a variable in the current scope.",e[c]);if((i=pe(e[c],s)).fulltype=be(e[c].content),s.variables.push(i),!e[c+=1]){if("procedure"===s.type)throw d('Procedure must finish with "ENDPROC".',e[c]);throw d('Function must finish with "=expression".',e[c])}","===e[c].content?c+=1:u="variables";break;case"subroutine":if("DIM"===e[c].content)throw d('"DIM" commands can only occur within the main program. To declare a local or private array, use "LOCAL" or "PRIVATE" instead.',e[c]);if("PRIVATE"===e[c].content)throw d("Private variables must be declared at the start of the subroutine.",e[c]);if("LOCAL"===e[c].content)throw d("Local variables must be declared at the start of the subroutine.",e[c]);if("DEF"===e[c].content)throw d('The next subroutine must be defined after subroutine "ENDPROC".',e[c]);if("variable"===e[c].type&&(ge(t[0],e[c].content)||ge(s,e[c].content)||((i=pe(e[c],t[0])).fulltype=be(e[c].content),t[0].variables.push(i))),"ENDPROC"===e[c].content){if("procedure"!==s.type)throw d('Function must end with "=&lt;expression&gt;", not "ENDPROC".',e[c]);c+=1,n=!1,u="end"}else if(e[c].line>e[c-1].line&&"="===e[c].content){if("function"!==s.type)throw d('Procedure must end with "ENDPROC", not "=&lt;expression&gt;".',e[c]);s.lexemes.push(e[c]),c+=1,u="result"}else s.lexemes.push(e[c]),c+=1;break;case"result":if(!e[c])throw d("Subroutine definition must be followed by some commands.",e[c-1]);for(l=e[c].line;e[c]&&e[c].line===l;)s.lexemes.push(e[c]),c+=1;r=!1,u="end"}if(a)throw d('Program must finish with "END".',e[c-1]);if(n)throw d('Procedure must finish with "ENDPROC".',e[c-1]);if(r)throw d('Function must finish with "=expression".',e[c-1]);return t};const ge=(e,t)=>e.variables.some(e=>(e.name||e.names.basic)===t),be=e=>{const t="%"===e.slice(-1)?"boolint":"string";return!!t&&me(t,"boolint"===t?0:34)},fe=e=>"PROC"===e.slice(0,4)?"procedure":"FN"===e.slice(0,2)&&"function";var ye=e=>{const t=[],a=[];let n,r,o=0,s=0,i="program";for(;o<e.length;)switch(i){case"program":({lex:o,routine:n,state:i}=xe(e,o)),t.push(n),a.push(n);break;case"crossroads":({lex:o,state:i}=we(e,o,n));break;case"constant":({lex:o,state:i}=ve(e,o,n));break;case"variable":({lex:o,state:i}=Ee(e,o,n));break;case"procedure":case"function":r=a[a.length-1],({lex:o,routine:n}=Le(e,o,i,r)),r.subroutines.push(n),a.push(n),i="crossroads";break;case"begin":({lex:o,state:i}=Ce(e,o,n));break;case"end":if(0===n.index){if(!e[o])throw d('Program "END" must be followed by a full stop.',e[o-1]);if("."!==e[o].content)throw d('Program "END" must be followed by a full stop.',e[o]);if(e[o+1])throw d('No text can appear after program "END".',e[o+1]);o+=1}else o=Me(e,o,!0),s+=1,n.index=s,t.push(a.pop()),n=a[a.length-1],i="crossroads"}return t};const xe=(e,t)=>{const[a,n]=e.slice(t,t+2);if(!a)throw d('Program must start with keyword "PROGRAM".');if("program"!==a.content)throw d('Program must start with keyword "PROGRAM".',a);if(!n)throw d('"PROGRAM" must be followed by a legal program name.',a);if("turtle"===n.type)throw d("Program cannot be given the name of a Turtle attribute.",n);if("identifier"!==n.type)throw d("{lex} is not a valid program name.",n);return{lex:Me(e,t+2,!0),routine:ce(n.content,"Pascal"),state:"crossroads"}},we=(e,t,a)=>{const n=e[t],r='Expected "BEGIN", constant/variable definitions, or subroutine definitions.';if(!n)throw d(r,e[t-1]);switch(n.content){case"const":if(a.variables.length>0)throw d("Constants must be defined before any variables.",n);if(a.subroutines.length>0)throw d("Constants must be defined before any subroutines.",n);return{lex:t+1,state:"constant"};case"var":if(a.subroutines.length>0)throw d("Variables must be defined before any subroutines.",n);return{lex:t+1,state:"variable"};case"function":case"procedure":return{lex:t+1,state:n.content};case"begin":return{lex:Me(e,t+1),state:"begin"};default:throw d(r,n)}},ve=(e,t,a)=>{const[n,r,o]=e.slice(t,t+3);if(!n)throw d("No constant name found.",e[t-1]);if("turtle"===n.type)throw d("{lex} is the name of a predefined Turtle property, and cannot be used as a constant name.",n);if("identifier"!==n.type)throw d("{lex} is not a valid constant name.",n);if(n.content===f(a).name)throw d("Constant name {lex} is already the name of the program.",n);if(Ie(a,n.content))throw d("{lex} is already the name of a constant in the current scope.",n);if(!r)throw d("Constant must be assigned a value.",n);if("="!==r.content||!o)throw d("Constant must be assigned a value.",r);let s="-"===o.content?ke(e,t+3,n.content,a):Te(e,t+2,n.content,a);if(a.constants.push(s.constant),!e[s.lex])throw d("No program text found after constant definition.",e[s.lex-1]);return"identifier"===e[s.lex].type?{lex:s.lex,state:"constant"}:{lex:s.lex,state:"crossroads"}},ke=(e,t,a,n)=>{const r=e[t];if(!r)throw d("Constant must be assigned a value.",e[t-1]);switch(r.type){case"string":throw d("Strings cannot be negated.",r);case"boolean":throw d("Boolean values cannot be negated.",r);case"integer":return{lex:Me(e,t+1,!0),constant:ue(a,r.type,-r.value)};case"identifier":let o=y(n,r.content,"Pascal")||w(r.content,"Pascal");if(!o)throw d("{lex} is not a valid constant value.",r);return{lex:Me(e,t+1,!0),constant:ue(a,o.type,-o.value)};default:throw d("{lex} is not a valid constant value.",r)}},Te=(e,t,a,n)=>{const r=e[t];if(!r)throw d("Constant must be assigned a value.",e[t-1]);switch(r.type){case"boolean":case"integer":case"string":return{lex:Me(e,t+1,!0),constant:ue(a,r.type,r.value)};case"identifier":let o=y(n,r.content,"Pascal")||w(r.content,"Pascal");if(!o)throw d("{lex} is not a valid constant value.",r);return{lex:Me(e,t+1,!0),constant:ue(a,o.type,o.value)};default:throw d("{lex} is not a valid constant value.",r)}},Ee=(e,t,a,n=!1,r=!1)=>{const o=[];let s=!0;for(;s;){if(!e[t])throw d("No variable name found.",e[t-1]);if("turtle"===e[t].type)throw d("{lex} is the name of a predefined Turtle property, and cannot be used as a variable name.",e[t]);if("identifier"!==e[t].type)throw d("{lex} is not a valid variable name.",e[t]);if(e[t].content===f(a).name)throw d("Variable name {lex} is already the name of the program.",e[t]);if(Ie(a,e[t].content))throw d("{lex} is already the name of a constant or variable in the current scope.",e[t]);if(o.push(pe(e[t],a,r)),!e[t+1])throw d("Variable name must be followed by a colon, then the variable type (array, boolean, char, integer, or string).",e[t]);if(","===e[t+1].content)t+=2;else{if(":"!==e[t+1].content)throw"identifier"===e[t+1].type?d("Comma missing between variable declarations.",e[t+1]):d("Variable name must be followed by a colon, then the variable type (array, boolean, char, integer, or string).",e[t+1]);t+=2,s=!1}}let i=Se(e,t,a,n,r);if(o.forEach(e=>{e.fulltype=i.fulltype}),a.variables=a.variables.concat(o),!e[t=n&&")"===e[i.lex].content?i.lex:Me(e,i.lex,!0)])throw d("No text found after variable declarations.",e[t-1]);return"identifier"===e[t].type?{lex:t,variables:o,state:"variable"}:{lex:t,variables:o,state:"crossroads"}},Se=(e,t,a,n,r)=>{const o=e[t];if(!e[t])throw d("Variable name must be followed by a colon, then the variable type (array, boolean, char, integer, or string).",e[t-1]);switch(o.content){case"boolean":case"integer":case"char":return{lex:t+1,fulltype:me(o.content)};case"string":if(e[t+1]&&"["===e[t+1].content){const[a,n]=e.slice(t+2,t+4);if(!a)throw d("Opening bracket must be followed by an integer value.",e[t+1]);if("integer"!==a.type)throw d("String size must be an integer.",a);if(!n)throw d('String size must be followed by a closing square bracket "]".',a);if("]"!==n.content)throw d('String size must be followed by a closing square bracket "]".',n);return{lex:t+4,fulltype:me("string",a.value)}}return{lex:t+1,fulltype:me("string")};case"array":return n?Re(e,t+1,a,r):Oe(e,t+1,a);default:throw d('{lex} is not a valid variable type (expected "array", "boolean", "char", "integer", or "string").',o)}},Re=(e,t,a,n)=>{if(!e[t])throw d('Array declaration must be followed by "of", and then the type of the elements of the array.',e[t-1]);if(!n)throw d("Array parameters can only be passed by reference, not by value.",e[t]);if("["===e[t].content)throw d("Array references parameters cannot be given a size specification.",e[t]);if("of"!==e[t].content)throw d('Array declaration must be followed by "of", and then the type of the elements of the array.',e[t]);return Se(e,t+1,a,!0,n)},Oe=(e,t,a)=>{const[n,r,o,s,i,l]=e.slice(t,t+6);let c,u,p;if(!n)throw d('Array declarations take the form "array[n..m]", where "n" and "m" are integer values specifying the start and end index of the array.',e[t-1]);if("["!==n.content)throw d('Array declarations take the form "array[n..m]", where "n" and "m" are integer values specifying the start and end index of the array.',n);if(!r)throw d('Array declarations take the form "array[n..m]", where "n" and "m" are integer values specifying the start and end index of the array.',n);switch(r.type){case"identifier":let e=y(a,r.content,"Pascal");if(!e)throw d("Constant {lex} has not been defined.",r);if("integer"!==e.type)throw d("{lex} is not an integer constant.",r);u=e.value;break;case"integer":u=r.value;break;default:throw d('Array declarations take the form "array[n..m]", where "n" and "m" are integer values specifying the start and end index of the array.',r)}if(!o)throw d('Array declarations take the form "array[n..m]", where "n" and "m" are integer values specifying the start and end index of the array.',r);if(".."!==o.content)throw d('Array declarations take the form "array[n..m]", where "n" and "m" are integer values specifying the start and end index of the array.',o);if(!s)throw d('Array declarations take the form "array[n..m]", where "n" and "m" are integer values specifying the start and end index of the array.',o);switch(s.type){case"identifier":let e=y(a,s.content,"Pascal");if(!e)throw d("Constant {lex} has not been defined.",s);if("integer"!==e.type)throw d("{lex} is not an integer constant.",s);c=e.value;break;case"integer":c=s.value;break;default:throw d('Array declarations take the form "array[n..m]", where "n" and "m" are integer values specifying the start and end index of the array.',s)}if(!i)throw d('Array declarations take the form "array[n..m]", where "n" and "m" are integer values specifying the start and end index of the array.',s);if("]"!==i.content)throw d('Array declarations take the form "array[n..m]", where "n" and "m" are integer values specifying the start and end index of the array.',i);if(!l)throw d('Array declaration must be followed by "of", and then the type of the elements of the array.',i);if("of"!==l.content)throw d('Array declaration must be followed by "of", and then the type of the elements of the array.',l);return{lex:(p=Se(e,t+6,a)).lex,fulltype:me("array",c-u+1,u,p.fulltype)}},Le=(e,t,a,n)=>{const r=e[t];let o,s;if(!r)throw d("No subroutine name found.",e[t-1]);if("turtle"===r.type)throw d("{lex} is the name of a predefined Turtle property, and cannot be used as a subroutine name.",r);if("identifier"!==r.type)throw d("{lex} is not a valid subroutine name.",r);if(r.content===f(n).name)throw d("Subroutine name {lex} is already the name of the program.",r);if(v(n,r.content,"Pascal"))throw d("{lex} is already the name of a subroutine in the current scope.",r);if(o=de(r.content,a,n),"function"===a&&o.variables.push(pe({content:"result"},o,!1)),!e[t+=1])throw d("Subroutine declaration must be followed by a semicolon.",r);if("("===e[t].content&&(s=Pe(e,t+1,o),o.parameters=s.parameters,o.variables=o.variables.concat(s.parameters),t=s.lex),"function"===a){if(!e[t])throw d("Function must be followed by a colon, the the return type (integer, boolean, char, or string).",e[t-1]);if(":"!==e[t].content)throw d("Function must be followed by a colon, the the return type (integer, boolean, char, or string).",e[t]);s=Se(e,t+1,o),o.variables[0].fulltype=s.fulltype,t=s.lex}return{lex:t=Me(e,t,!0),routine:o}},Pe=(e,t,a)=>{let n,r=[],o=!0;for(;o;){if(n=e[t]&&"var"===e[t].content?Ee(e,t+1,a,!0,!0):Ee(e,t,a,!0,!1),r=r.concat(n.variables),!e[t=n.lex])throw d('Parameter declarations must be followed by a closing bracket ")".',e[t-1]);switch(e[t].content){case";":t+=1;break;case")":t+=1,o=!1;break;default:throw d('Parameter declarations must be followed by a closing bracket ")".',e[t])}}return{lex:t,parameters:r}},Ce=(e,t,a)=>{let n=1;for(;n>0&&e[t];)"begin"===e[t].content&&(n+=1),"end"===e[t].content&&(n-=1),a.lexemes.push(e[t]),t+=1;if(n>0)throw d('Routine commands must finish with "END".',e[t]);return a.lexemes.pop(),{lex:t,state:"end"}},Ie=(e,t)=>e.variables.concat(e.constants).some(e=>e.name===t),Me=(e,t,a=!1)=>{if(a){if(!e[t])throw d("Semicolon needed after statement.",e[t-1]);if(";"!==e[t].content)throw d("Semicolon needed after statement.",e[t])}for(;e[t]&&";"===e[t].content;)t+=1;return t};var Ae=e=>{const t=[],a=[];let n,r=0,o="crossroads";for(n=ce("!","Python"),t.push(n),a.push(n);r<e.length;)switch(o){case"crossroads":({lex:r,state:o}=Ne(e,r,n));break;case"global":({lex:r,state:o}=De(e,r,n));break;case"nonlocal":({lex:r,state:o}=Fe(e,r,n));break;case"def":({lex:r,routine:n,state:o}=Be(e,r,n)),a.push(n);break;case"parameters":({lex:r,state:o}=Ue(e,r,n));break;case"commands":({lex:r,state:o}=Ge(e,r,n)),null===n.index&&(n.index=t.length,t.push(a.pop()),n=a[a.length-1])}if(0===t[0].lexemes.length){if(!t.some(e=>"main"===e.name))throw d('Program must have some commands or define a "main" procedure.',e[e.length-1]);t[0].lexemes=[{type:"identifier",content:"main",indent:0},{type:"punctuation",content:"(",indent:0},{type:"punctuation",content:")",indent:0}]}return t};const Ne=(e,t,a)=>{if(!e[t])throw d("No commands given.",e[t-1]);if(a.indent){if(e[t].offset<a.indent)throw d("Not enough indentation.",e[t]);if(e[t].offset>a.indent)throw d("Too much indentation.",e[t])}else a.indent=e[t].offset;switch(e[t].content){case"global":if(0===a.index)throw d("Global variables are only allowed in subroutines.",e[t]);if(a.subroutines.length>0)throw d("Global variables must be declared before any subroutine definitions.",e[t]);return{lex:t+1,state:"global"};case"nonlocal":if(0===a.index)throw d("Nonlocal variables are only allowed in subroutines.",e[t]);if(a.subroutines.length>0)throw d("Nonlocal variables must be declared before any subroutine definitions.",e[t]);return{lex:t+1,state:"nonlocal"};case"def":if(a.lexemes.length>0)throw d("Subroutine definitions must come before the routine's commands",e[t]);return{lex:t+1,state:"def"};default:return{lex:t,state:"commands"}}},De=(e,t,a)=>{if(!e[t])throw d('"global" must be followed by an identifier.',e[t-1]);if(e[t].line!==e[t-1].line)throw d("Global variable declarations must be on a single line.",e[t]);for(;e[t]&&e[t].line===e[t-1].line;){if("turtle"!==e[t].type&&"identifier"!==e[t].type)throw d("{lex} is not a valid variable name.",e[t]);if(a.globals.indexOf(e[t].content)>-1)throw d("Global variable {lex} has already been declared.",e[t]);a.globals.push(e[t].content);const n=f(a);if("turtle"===e[t].type||n.variables.some(a=>a.name===e[t].content)||n.variables.push(pe(e[t],n)),e[t+1].line>e[t].line)return{lex:t+1,state:"crossroads"};if(!e[t+1]||","!==e[t+1].content)throw d("Comma missing after global variable declaration.",e[t]);if(!e[t+2])throw d("Expected more global variable declarations after comma.",e[t+1]);if(e[t+2].line>e[t+1].line)throw d("Global variable declarations must be on a single line.",e[t+2]);t+=2}return{lex:t,state:"crossroads"}},Fe=(e,t,a)=>{if(!e[t])throw d('"local" must be followed by an identifier.',e[t-1]);if(e[t].line>e[t-1].line)throw d("Nonlocal variable definitions must be on a single line.",e[t]);if(a.nonlocals.indexOf(e[t].content)>-1)throw d("Nonlocal variable {lex} has already been defined.",e[t]);for(;e[t]&&e[t].line===e[t-1].line;){if("turtle"===e[t].type)throw d("Turtle variables are global, not nonlocal.",e[t]);if("identifier"!==e[t].type)throw d("{lex} is not a valid variable name.",e[t]);if(a.nonlocals.indexOf(e[t].content)>-1)throw d("Nonlocal variable {lex} has already been declared.",e[t]);if(a.nonlocals.push(e[t].content),e[t+1].line>e[t].line)return{lex:t+1,state:"crossroads"};if(!e[t+1]||","!==e[t+1].content)throw d("Comma missing after nonlocal variable declaration.",e[t]);if(!e[t+2])throw d("Expected more nonlocal variable declarations after comma.",e[t+1]);if(e[t+2].line>e[t+1].line)throw d("Nonlocal variable declarations must be on a single line.",e[t+2]);t+=2}return{lex:t,state:"crossroads"}},Be=(e,t,a)=>{if(!e[t])throw d('"def" must be followed by an identifier.',e[t-1]);if(e[t-1].line!==e[t].line)throw d('Subroutine name must be on the same line as "def".',e[t]);if("turtle"===e[t].type)throw d("Subroutine cannot have the name of a global Turtle variable.",e[t]);if("identifier"!==e[t].type)throw d("{lex} is not a valid subroutine name.",e[t]);if(qe(e[t].content,a))throw d("{lex} is already the name of a subroutine or variable in the current scope.",e[t]);if((a=de(e[t].content,"procedure",a)).parent.subroutines.push(a),!e[t+1])throw d("Subroutine definition must be followed by an open bracket.",e[t-1]);if("("!==e[t+1].content)throw d("Subroutine definition must be followed by an open bracket.",e[t]);if(e[t].line!==e[t+1].line)throw d("Open bracket must be on the same line as the subroutine definition.",e[t]);return{lex:t+2,routine:a,state:"parameters"}},Ue=(e,t,a)=>{if(!e[t])throw d("Expecting parameter definition or closing bracket.",e[t-1]);if(")"===e[t].content){if(e[t-1].line!==e[t].line)throw d("Closing bracket after parameters cannot be on a new line.",e[t]);if(!e[t+1])throw d("Subroutine definition must be followed by a colon.",e[t]);if(":"!==e[t+1].content)throw d("Subroutine definition must be followed by a colon.",e[t+1]);if(e[t+1].line>e[t].line)throw d("Colon following subroutine definition cannot be on a new line.",e[t+1]);if(!e[t+2])throw d("No commands found following subroutine declaration.",e[t+1]);if(e[t+2].line===e[t+1].line)throw d("Subroutine commands must be on a new line.",e[t]);return{lex:t+2,state:"crossroads"}}if("turtle"===e[t].type)throw d("{lex} is the name of a predefined global Turtle variable.",e[t]);if("identifier"!==e[t].type)throw d("{lex} is not a valid identifier.",e[t]);if(e[t-1].line!==e[t].line)throw d("Parameter declaration cannot be on a new line.",e[t]);if(a.parameters.some(a=>a.name===e[t].content))throw d("{lex} is already the name of a parameter for this subroutine.",e[t]);let n=pe(e[t],a);if(a.parameters.push(n),a.variables.push(n),!e[t+1])throw d("Closing bracket missing after parameter declarations.",e[t]);if("turtle"===e[t+1].type||"identifier"===e[t+1].type)throw d("Comma missing between parameters.",e[t+1]);if(","===e[t+1].content){if(!e[t+2])throw d("Expected parameter declaration after comma.",e[t+1]);if(")"===e[t+2].content)throw d("Parameter list cannot end with a comma.",e[t+1]);return{lex:t+2,state:"parameters"}}if(")"===e[t+1].content)return{lex:t+1,state:"parameters"};throw d("py1parser43","parsNoCommaOrBracket",e[t])},Ge=(e,t,a)=>{let n;for(;e[t]&&e[t].offset>=a.indent;){if("return"===e[t].content){if(0===a.index)throw d("cmdMainReturn",e[t]);if("main"===a.name)throw d("cmdMainSubReturn",e[t]);if("function"===a.type)throw d("cmdRepeatReturn",e[t]);a.type="function",n=pe(e[t],a,!1),a.variables.unshift(n)}He(a,e,t)&&(n=pe(e[t],a,!1),a.variables.push(n)),a.lexemes.push(e[t]),t+=1}return{lex:t,state:"crossroads"}},qe=(e,t)=>0===t.index?t.subroutines.some(t=>t.name===e):t.subroutines.some(t=>t.name===e)||t.globals.indexOf(e)>-1||t.nonlocals.indexOf(e)>-1,He=(e,t,a)=>"identifier"===t[a].type&&(!!t[a+1]&&(("="===t[a+1].content||"in"===t[a+1].content)&&(!(e.globals.indexOf(t[a].content)>-1)&&(!(e.nonlocals.indexOf(t[a].content)>-1)&&!x(e,t[a].content,"Python")))));const je=(e,t)=>{for(var a,n,r=e[t],o=r.lexemes,s=0;s<o.length;)if("identifier"===o[s].type)if((a=x(r,o[s].content,"Python"))&&null===a.fulltype){if(o[s+=1]&&"in"===o[s].content)a.fulltype=me("integer"),s+=1;else if(o[s]&&"="===o[s].content&&o[s+=1])try{n=K(r,s,"null","null","Python"),a.fulltype=me(n.type),s=n.lex}catch(e){s+=1}}else s+=1;else if("return"===o[s].content){if(a=x(r,"return","Python"),o[s+=1])try{n=K(r,s,"null","null","Python"),a.fulltype=me(n.type),s=n.lex}catch(e){s+=1}}else s+=1;return 0===t?1===e.length?e:je(e,e.length-1):t>1?je(e,t-1):e},$e=function(e,t){for(var a,n,r,o=e[t],s=o.lexemes,i=0;i<s.length;){if("identifier"===s[i].type&&(a=v(o,s[i].content,"Python"))&&a.parameters.length>0)for(n=0,i+=2;n<a.parameters.length;){try{r=K(o,i,"null","null","Python"),null===a.parameters[n].fulltype&&(a.parameters[n].fulltype=me(r.type)),i=r.lex+1}catch(e){}n+=1}i+=1}return 1===t?e:$e(e,t-1)},We=e=>{return e.reduce((e,t)=>e.concat(t.variables),[]).find(e=>null===e.fulltype)},ze=e=>{let t=0;e.variables.forEach(e=>{t+=1,e.index=t,e.fulltype&&null!==e.fulltype.length&&(t+=e.fulltype.length)}),e.memoryNeeded=t},Ye=e=>10+(e=>e.some(e=>"function"===e.type)?e.length+1:e.length)(e),Xe=(e,t,a)=>{let n;switch(e.lexemes[t].type){case"turtle":case"identifier":if(e.lexemes[t+1]&&"="===e.lexemes[t+1].content){n=Q(e,e.lexemes[t].content,t+2,"BASIC");break}n=_(e,t,"BASIC");break;case"keyword":switch(e.lexemes[t].content){case"IF":n=Ve(e,t+1,a);break;case"FOR":n=Ke(e,t+1,a);break;case"REPEAT":n=Qe(e,t+1,a);break;case"WHILE":n=_e(e,t+1,a);break;default:throw d("{lex} makes no sense here.",e.lexemes[t])}break;default:throw d("{lex} makes no sense here.",e.lexemes[t])}if(e.lexemes[n.lex])if(":"!==e.lexemes[n.lex].content){if(e.lexemes[n.lex].line===e.lexemes[n.lex-1].line&&"else"!==e.lexemes[n.lex].type)throw d("Command must be on a new line, or followed by a colon.",e.lexemes[n.lex-1])}else for(;e.lexemes[n.lex]&&":"===e.lexemes[n.lex].content;)n.lex+=1;return n},Ve=(e,t,a)=>{let n,r,o,s,i;if(!e.lexemes[t])throw d('"IF" must be followed by a boolean expression.',e.lexemes[t-1]);if(t=(i=K(e,t,"null","boolean","BASIC")).lex,n=i.pcode[0],!e.lexemes[t])throw d('"IF ..." must be followed by "THEN".',e.lexemes[t-1]);if("THEN"!==e.lexemes[t].content)throw d('"IF ..." must be followed by "THEN".',e.lexemes[t]);if(t+=1,!e.lexemes[t])throw d('No commands found after "IF".',e.lexemes[t]);if(e.lexemes[t].line>e.lexemes[t-1].line?(i=Ze(e,t,a+1,"IF"),s=!1):(i=Xe(e,t,a+1),s=!0),t=i.lex,r=i.pcode,e.lexemes[t]&&"ELSE"===e.lexemes[t].content){if(s&&e.lexemes[t].line>e.lexemes[t-1].line)throw d('"ELSE" cannot be on a new line.',e.lexemes[t]);if(t+=1,!e.lexemes[t])throw d('No commands found after "ELSE".',e.lexemes[t]);t=(i=e.lexemes[t].line>e.lexemes[t-1].line?Ze(e,t,a+r.length+2,"ELSE"):Xe(e,t,a+r.length+2)).lex,o=i.pcode}return{lex:t,pcode:N(a,n,r,o)}},Ke=(e,t,a)=>{let n,r,o,s,i,l,c;if(!e.lexemes[t])throw d('"FOR" must be followed by an integer variable.',e.lexemes[t-1]);if("turtle"===e.lexemes[t].type)throw d('Turtle attribute cannot be used as a "FOR" variable.',e.lexemes[t]);if("identifier"!==e.lexemes[t].type)throw d('"FOR" must be followed by an integer variable.',e.lexemes[t]);if(!(n=x(e,e.lexemes[t].content)))throw d("Variable {lex} not defined.",e.lexemes[t]);if("integer"!==n.fulltype.type&&"boolint"!==n.fulltype.type)throw d("{lex} is not an integer variable.",e.lexemes[t]);if(t+=1,!e.lexemes[t])throw d('"FOR" loop variable must be assigned an initial value.',e.lexemes[t-1]);if("="!==e.lexemes[t].content)throw d('"FOR" loop variable must be assigned an initial value.',e.lexemes[t]);if(t+=1,!e.lexemes[t])throw d('"FOR" loop variable must be assigned an initial value.',e.lexemes[t-1]);if(t=(c=K(e,t,"null","integer","Pascal")).lex,r=c.pcode[0],!e.lexemes[t])throw d("forToDownTo",e.lexemes[t-1]);if("TO"!==e.lexemes[t].content)throw d('"FOR" loop initialisation must be followed by "TO".',e.lexemes[t]);if(t+=1,!e.lexemes[t])throw d('"TO" must be followed by an integer (or integer constant).',e.lexemes[t-1]);if(t=(c=K(e,t,"null","integer","Pascal")).lex,o=c.pcode[0],e.lexemes[t]&&"STEP"===e.lexemes[t].content){if(t+=1,!e.lexemes[t])throw d('"STEP" instruction must be of the form "STEP -1".',e.lexemes[t-1]);if("-"!==e.lexemes[t].content)throw d('"STEP" instruction must be of the form "STEP -1".',e.lexemes[t]);if(t+=1,!e.lexemes[t])throw d('"STEP" instruction must be of the form "STEP -1".',e.lexemes[t-1]);if(1!==e.lexemes[t].value)throw d('"STEP" instruction must be of the form "STEP -1".',e.lexemes[t]);t+=1,s="lseq",i="decr"}else s="mreq",i="incr";if(!e.lexemes[t])throw d('No commands found after "FOR" loop initialisation.',e.lexemes[t]);return t=(c=e.lexemes[t-1].line<e.lexemes[t].line?Ze(e,t,a+3,"FOR"):Xe(e,t,a+3)).lex,l=c.pcode,{lex:t,pcode:D(a,n,r,o,s,i,l)}},Qe=(e,t,a)=>{let n,r,o;if(t=(o=Ze(e,t,a,"REPEAT")).lex,r=o.pcode,!e.lexemes[t])throw d('"UNTIL" must be followed by a boolean expression.',e.lexemes[t-1]);return t=(o=K(e,t,"null","boolean",!1)).lex,n=o.pcode[0],{lex:t,pcode:F(a,n,r)}},_e=(e,t,a)=>{let n,r,o;if(!e.lexemes[t])throw d('"WHILE" must be followed by a boolean expression.',e.lexemes[t-1]);if(t=(o=K(e,t,"null","boolean","BASIC")).lex,n=o.pcode[0],!e.lexemes[t])throw d('No commands found after "WHILE ... DO".',e.lexemes[t]);return t=(o=e.lexemes[t].line>e.lexemes[t-1].line?Ze(e,t,a+1,"WHILE"):Xe(e,t,a+1)).lex,r=o.pcode,{lex:t,pcode:B(a,n,r)}},Ze=(e,t,a,n)=>{let r,o=[],s=!1;if(!e.lexemes[t])throw d(`No commands found after "${n}".`,e.lexemes[t-1]);for(;!s&&t<e.lexemes.length;)(s=Je(n,e.lexemes[t]))?"ELSE"!==e.lexemes[t].content&&(t+=1):(r=o,({lex:t,pcode:o}=Xe(e,t,a+o.length)),o=r.concat(o));if(!s)throw d(`Unterminated "${n}" statement.`,e.lexemes[t-1]);return{lex:t,pcode:o}},Je=(e,t)=>{switch(t.content){case"ELSE":if("IF"!==e)throw d('"ELSE" does not have any matching "IF".',t);return!0;case"ENDIF":if("IF"!==e&&"else"!==e)throw d('"ENDIF" does not have any matching "IF".',t);return!0;case"NEXT":if("FOR"!==e)throw d('"NEXT" does not have any matching "FOR".',t);return!0;case"UNTIL":if("REPEAT"!==e)throw d('"UNTIL" does not have any matching "REPEAT".',t);return!0;case"ENDWHILE":if("WHILE"!==e)throw d('"ENDWHILE" does not have any matching "WHILE".',t);return!0;default:return!1}},et=(e,t,a)=>{const n=["begin","do",".","repeat",";","then"],r=["else","end",";","until"];let o;switch(e.lexemes[t].type){case"turtle":case"identifier":if(e.lexemes[t+1]&&"="===e.lexemes[t+1].content)throw d('Variable assignment in Pascal uses ":=", not "=".',e.lexemes[t+1]);if(e.lexemes[t+1]&&":="===e.lexemes[t+1].content){o=Q(e,e.lexemes[t].content,t+2,"Pascal");break}o=_(e,t,"Pascal");break;case"keyword":switch(e.lexemes[t].content){case"if":o=tt(e,t+1,a);break;case"for":o=at(e,t+1,a);break;case"repeat":o=nt(e,t+1,a);break;case"while":o=rt(e,t+1,a);break;default:throw d("Command cannot begin with {lex}.",e.lexemes[t])}break;default:throw d("Command cannot begin with {lex}.",e.lexemes[t])}if(e.lexemes[o.lex])if(";"!==e.lexemes[o.lex].content){if(-1===n.indexOf(e.lexemes[o.lex-1].content)&&-1===r.indexOf(e.lexemes[o.lex].content))throw d("Semicolon needed after command.",e.lexemes[o.lex])}else for(;e.lexemes[o.lex]&&";"===e.lexemes[o.lex].content;)o.lex+=1;return o},tt=(e,t,a)=>{let n,r,o,s;if(!e.lexemes[t])throw d('"IF" must be followed by a boolean expression.',e.lexemes[t-1]);if(t=(s=K(e,t,"null","boolean","Pascal")).lex,n=s.pcode[0],!e.lexemes[t])throw d('"IF ..." must be followed by "THEN".',e.lexemes[t-1]);if("then"!==e.lexemes[t].content)throw d('"IF ..." must be followed by "THEN".',e.lexemes[t]);if(t+=1,!e.lexemes[t])throw d('No commands found after "IF".',e.lexemes[t]);if(t=(s="begin"===e.lexemes[t].content?ot(e,t+1,a+1,"begin"):et(e,t,a+1)).lex,r=s.pcode,"else"===e.lexemes[t].content){if(t+=1,!e.lexemes[t])throw d('No commands found after "ELSE".',e.lexemes[t]);t=(s="begin"===e.lexemes[t].content?ot(e,t+1,a+r.length+2,"begin"):et(e,t,a+r.length+2)).lex,o=s.pcode}return{lex:t,pcode:N(a,n,r,o)}},at=(e,t,a)=>{let n,r,o,s,i,l,c;if(!e.lexemes[t])throw d('"FOR" must be followed by an integer variable.',e.lexemes[t-1]);if("turtle"===e.lexemes[t].type)throw d('Turtle attribute cannot be used as a "FOR" variable.',e.lexemes[t]);if("identifier"!==e.lexemes[t].type)throw d('"FOR" must be followed by an integer variable.',e.lexemes[t]);if(!(n=x(e,e.lexemes[t].content)))throw d("Variable {lex} has not been declared.",e.lexemes[t]);if("integer"!==n.fulltype.type)throw d("{lex} is not an integer variable.",e.lexemes[t]);if(t+=1,!e.lexemes[t])throw d('"FOR" loop variable must be assigned an initial value.',e.lexemes[t-1]);if("="===e.lexemes[t].content)throw d('Assignment operator is ":=", not "=".',e.lexemes[t]);if(":="!==e.lexemes[t].content)throw d('"FOR" loop variable must be assigned an initial value.',e.lexemes[t]);if(t+=1,!e.lexemes[t])throw d('"FOR" loop variable must be assigned an initial value.',e.lexemes[t-1]);if(t=(c=K(e,t,"null","integer","Pascal")).lex,r=c.pcode[0],!e.lexemes[t])throw d('"FOR ... := ..." must be followed by "TO" or "DOWNTO".',e.lexemes[t-1]);switch(e.lexemes[t].content){case"to":s="mreq",i="incr";break;case"downto":s="lseq",i="decr";break;default:throw d('"FOR ... := ..." must be followed by "TO" or "DOWNTO".',e.lexemes[t])}if(t+=1,!e.lexemes[t])throw d('"TO" or "DOWNTO" must be followed by an integer (or integer constant).',e.lexemes[t-1]);if(t=(c=K(e,t,"null","integer","Pascal")).lex,o=c.pcode[0],!e.lexemes[t])throw d('"FOR" loop range must be followed by "DO".',e.lexemes[t-1]);if("do"!==e.lexemes[t].content)throw d('"FOR" loop range must be followed by "DO".',e.lexemes[t]);if(t+=1,!e.lexemes[t])throw d('No commands found after "FOR" loop initialisation.',e.lexemes[t-1]);return t=(c="begin"===e.lexemes[t].content?ot(e,t+1,a+3,"begin"):et(e,t,a+3)).lex,l=c.pcode,{lex:t,pcode:D(a,n,r,o,s,i,l)}},nt=(e,t,a)=>{let n,r,o;if(t=(o=ot(e,t,a,"repeat")).lex,r=o.pcode,!e.lexemes[t])throw d('"UNTIL" must be followed by a boolean expression.',e.lexemes[t-1]);return t=(o=K(e,t,"null","boolean",!1)).lex,n=o.pcode[0],{lex:t,pcode:F(a,n,r)}},rt=(e,t,a)=>{let n,r,o;if(!e.lexemes[t])throw d('"WHILE" must be followed by a boolean expression.',e.lexemes[t-1]);if(t=(o=K(e,t,"null","boolean",!1)).lex,n=o.pcode[0],!e.lexemes[t])throw d('"WHILE ..." must be followed by "DO".',e.lexemes[t-1]);if("do"!==e.lexemes[t].content)throw d('"WHILE ..." must be followed by "DO".',e.lexemes[t]);if(t+=1,!e.lexemes[t])throw d('No commands found after "WHILE" loop initialisation.',e.lexemes[t]);return t=(o="begin"===e.lexemes[t].content?ot(e,t+1,a+1,"begin"):et(e,t,a+1)).lex,r=o.pcode,{lex:t,pcode:B(a,n,r)}},ot=(e,t,a,n)=>{let r,o=[],s=!1;if(!e.lexemes[t])throw d('No commands found after "BEGIN".',e.lexemes[t-1]);for(;!s&&t<e.lexemes.length;)(s=st(n,e.lexemes[t]))?t+=1:(r=o,({lex:t,pcode:o}=et(e,t,a+o.length)),o=r.concat(o));if(!s)throw d('"BEGIN" does not have any matching "END".',e.lexemes[t-1]);return{lex:t,pcode:o}},st=(e,t)=>{switch(t.content){case"end":if("begin"!==e)throw d('"END" does not have any matching "BEGIN".',t);return!0;case"until":if("repeat"!==e)throw d('"UNTIL" does not have any matching "REPEAT".',t);return!0;default:return!1}},it=(e,t,a)=>{let n;switch(e.lexemes[t].type){case"turtle":case"identifier":if(e.lexemes[t+1]&&"=="===e.lexemes[t+1].content)throw d('Variable assignment in Python uses "=", not "==".',e.lexemes[t+1]);if(e.lexemes[t+1]&&"="===e.lexemes[t+1].content){n=Q(e,e.lexemes[t].content,t+2,"Python");break}n=_(e,t,"Python");break;case"keyword":switch(e.lexemes[t].content){case"return":n=Q(e,"return",t+1,"Python");break;case"if":n=lt(e,t+1,a);break;case"for":n=ct(e,t+1,a);break;case"while":n=dt(e,t+1,a);break;default:throw d("{lex} makes no sense here.",e.lexemes[t])}break;default:throw d("{lex} makes no sense here.",e.lexemes[t])}if(e.lexemes[n.lex]&&e.lexemes[n.lex].line===e.lexemes[n.lex-1].line)throw d("Command must be on a new line.",e.lexemes[n.lex]);return n},lt=(e,t,a)=>{let n,r,o,s;if(!e.lexemes[t])throw d("if01",e.lexemes[t-1]);if(!ut(e.lexemes,t))throw d("if02",e.lexemes[t]);if(t=(s=K(e,t,"null","boolean","Python")).lex,n=s.pcode[0],!e.lexemes[t])throw d("if03",e.lexemes[t-1]);if(!mt(e.lexemes,t,":"))throw d("if04",e.lexemes[t]);if(t+=1,!e.lexemes[t])throw d("if05",e.lexemes[t-1]);if(ut(e.lexemes,t))throw d("if06",e.lexemes[t]);if(!ht(e.lexemes,t))throw d("if07",e.lexemes[t]);if(t=(s=gt(e,t,a+1,e.lexemes[t].offset)).lex,r=s.pcode,e.lexemes[t]&&"else"===e.lexemes[t].content){if(ut(e.lexemes,t))throw d("if08",e.lexemes[t]);if(t+=1,!e.lexemes[t])throw d("if09",e.lexemes[t-1]);if(!mt(e.lexemes,t,":"))throw d("if10",e.lexemes[t]);if(t+=1,!e.lexemes[t])throw d("if11",e.lexemes[t-1]);if(ut(e.lexemes,t))throw d("if12",e.lexemes[t]);if(!ht(e.lexemes,t))throw d("if13",e.lexemes[t]);t=(s=gt(e,t,a+r.length+2,e.lexemes[t].offset)).lex,o=s.pcode}return{lex:t,pcode:N(a,n,r,o)}},ct=(e,t,a)=>{let n,r,o,s,i,l,c;if(!e.lexemes[t])throw d("for01",e.lexemes[t-1]);if("turtle"===e.lexemes[t].type)throw d("for02",e.lexemes[t]);if(!pt(e.lexemes,t,"identifier"))throw d("for03",e.lexemes[t]);if(!(n=x(e,e.lexemes[t].content,"Python")))throw d("for04",e.lexemes[t]);if("integer"!==n.fulltype.type&&"boolint"!==n.fulltype.type)throw d("for05",e.lexemes[t]);if(t+=1,!e.lexemes[t])throw d("for06",e.lexemes[t-1]);if(!mt(e.lexemes,t,"in"))throw d("for07",e.lexemes[t]);if(t+=1,!e.lexemes[t])throw d("for08",e.lexemes[t-1]);if(!mt(e.lexemes,t,"range"))throw d("for09",e.lexemes[t]);if(t+=1,!e.lexemes[t])throw d("for10",e.lexemes[t-1]);if(!mt(e.lexemes,t,"("))throw d("for11",e.lexemes[t]);if(t+=1,!e.lexemes[t])throw d("for12",e.lexemes[t-1]);if(!ut(e.lexemes,t))throw d("for13",e.lexemes[t]);if(t=(c=K(e,t,"null","integer","Python")).lex,r=c.pcode[0],!e.lexemes[t])throw d("for14",e.lexemes[t-1]);if(!mt(e.lexemes,t,","))throw d("for15",e.lexemes[t]);if(t+=1,!e.lexemes[t])throw d("for16",e.lexemes[t-1]);if(!ut(e.lexemes,t))throw d("for17",e.lexemes[t]);if(t=(c=K(e,t,"null","integer","Python")).lex,o=c.pcode[0],!e.lexemes[t])throw d("for18",e.lexemes[t-1]);if(!mt(e.lexemes,t,","))throw d("for19",e.lexemes[t]);if(t+=1,!e.lexemes[t])throw d("for20",e.lexemes[t-1]);if(!ut(e.lexemes,t))throw d("for21",e.lexemes[t]);if("integer"===e.lexemes[t].type){if(1!==e.lexemes[t].value)throw d("for22",e.lexemes[t]);s="more",i="incr"}else{if("-"!==e.lexemes[t].content)throw d("for26",e.lexemes[t]);if(t+=1,!e.lexemes[t])throw d("for23",e.lexemes[t-1]);if(!pt(e.lexemes,t,"integer"))throw d("for24",e.lexemes[t]);if(1!==e.lexemes[t].value)throw d("for25",e.lexemes[t]);s="less",i="decr"}if(t+=1,!e.lexemes[t])throw d("for27",e.lexemes[t-1]);if(!mt(e.lexemes,t,")"))throw d("for28",e.lexemes[t]);if(t+=1,!e.lexemes[t])throw d("for29",e.lexemes[t-1]);if(!mt(e.lexemes,t,":"))throw d("for30",e.lexemes[t]);if(t+=1,!e.lexemes[t])throw d("for31",e.lexemes[t-1]);if(ut(e.lexemes,t))throw d("for32",e.lexemes[t]);if(!ht(e.lexemes,t))throw d("for33",e.lexemes[t]);return t=(c=gt(e,t,a+3,e.lexemes[t].offset)).lex,l=c.pcode,{lex:t,pcode:D(a,n,r,o,s,i,l)}},dt=(e,t,a)=>{let n,r,o;if(!e.lexemes[t])throw d("while01",e.lexemes[t-1]);if(!ut(e.lexemes,t))throw d("while02",e.lexemes[t]);if(t=(o=K(e,t,"null","boolean","Python")).lex,n=o.pcode[0],!e.lexemes[t])throw d("while03",e.lexemes[t-1]);if(!mt(e.lexemes,t,":"))throw d("while04",e.lexemes[t]);if(t+=1,!e.lexemes[t])throw d("while05",e.lexemes[t-1]);if(ut(e.lexemes,t))throw d("while06",e.lexemes[t]);if(!ht(e.lexemes,t))throw d("while07",e.lexemes[t]);return t=(o=gt(e,t,a+1,e.lexemes[t].offset)).lex,r=o.pcode,{lex:t,pcode:B(a,n,r)}},ut=(e,t)=>e[t].line===e[t-1].line,pt=(e,t,a)=>ut(e,t)&&e[t].type===a,mt=(e,t,a)=>ut(e,t)&&e[t].content===a,ht=(e,t)=>e[t].offset>e[t-1].offset,gt=(e,t,a,n)=>{let r,o=[],s=!1;if(!e.lexemes[t])throw d("blockNothing",e.lexemes[t-1]);for(;!s&&t<e.lexemes.length;)(s=e.lexemes[t].offset<n)||(r=o,({lex:t,pcode:o}=it(e,t,a+o.length)),o=r.concat(o));return{lex:t,pcode:o}};var bt=(e,t)=>{const a=e[0],n=e.slice(1).length>0?4:3,r=ft(e,n,t),o=n+r.length,s=yt(a,o,t);return((e,t,a)=>{const n=X(e),r=[[R.a.jump,n.length+t.length+2]],o=[[R.a.halt]];return t.length>1?n.concat(r).concat(t).concat(a).concat(o):n.concat(a).concat(o)})(e[0],r,s)};const ft=(e,t,a)=>{let n=[],r=1;for(;r<e.length;){e[r].startLine=t;const o=G(e[r]).length;let s=yt(e[r],t+o,a),i=U(e[r],s);n=n.concat(i),r+=1,t+=i.length}return n},yt=(e,t,a)=>{const n={BASIC:Xe,Pascal:et,Python:it};let r=[],o=0;for(;o<e.lexemes.length;){let s=n[a].call(null,e,o,t+r.length);r=r.concat(s.pcode),o=s.lex}return r};var xt=(e,t)=>{const a=((e,t)=>{const a=Object(u.a)(e,t),n=[],r=["BASIC","Pascal","Python"].indexOf(t);let o=0,s=1,i=!0,l=0;for(;o<a.length;){switch(a[o].type){case"linebreak":s+=1,i=!0,l=0;break;case"spaces":i&&(l=a[o].content.length),i=!1;break;case"comment":i=!1;break;case"unterminated-comment":throw d(p[0],m(a[o],s,l,t));case"unterminated-string":throw d(p[1],m(a[o],s,l,t));case"bad-binary":throw d(p[2+r],m(a[o],s,l,t));case"bad-octal":throw d(p[5+r],m(a[o],s,l,t));case"bad-hexadecimal":throw d(p[8+r],m(a[o],s,l,t));case"bad-decimal":throw d(p[11],m(a[o],s,l,t));case"illegal":throw d(p[12],m(a[o],s,l,t));default:i=!1,n.push(m(a[o],s,l,t))}o+=1}return n})(e,t),n=((e,t)=>{const a={BASIC:he,Pascal:ye,Python:Ae};if(0===e.length)throw d("Program does not contain any lexemes.");const n=a[t](e),r=n[0],o=n.slice(1);if("Python"===t){je(n,0),n.length>1&&$e(n,n.length-1);const e=We(n);if(e)throw d("Could not detetermine type of variable {lex}.",e.lexeme)}return n.forEach(ze),r.turtleAddress=Ye(o),n})(a,t);console.log(n);const r=bt(n,t);return console.log(r),{usage:((e,t,a)=>s.c.concat({title:"Subroutine calls",expressions:t}).map(c.bind(null,a,e)).filter(e=>e.expressions.length>0))(a,n.slice(1),t),pcode:r}};const wt=(e,t)=>{Bt.addEventListener(e,t)},vt=(e,t)=>{Bt.removeEventListener(e,t)},kt=()=>Bt.getBoundingClientRect(),Tt=(e,t)=>{Bt.width=e,Bt.height=t},Et=e=>{const t=e<0||e>15?1:e;Bt.style.cursor=r.b[t].css},St=(e,t,a,o)=>{Ut.textBaseline="top",Ut.fillStyle=Object(n.c)(e.c),Ut.font=`${o}pt ${r.d[15&a].css}`,(16&a)>0&&(Ut.font=`bold ${Ut.font}`),(32&a)>0&&(Ut.font=`italic ${Ut.font}`),Ut.fillText(t,e.x,e.y)},Rt=(e,t,a)=>{Ut.beginPath(),Ut.moveTo(e.x,e.y),Ut.lineTo(t,a),Ut.lineCap="round",Ut.lineWidth=e.t,Ut.strokeStyle=Object(n.c)(e.c),Ut.stroke()},Ot=(e,t,a)=>{Ut.beginPath(),t.forEach((e,t)=>{0===t?Ut.moveTo(e[0],e[1]):Ut.lineTo(e[0],e[1])}),a?(Ut.closePath(),Ut.fillStyle=Object(n.c)(e.c),Ut.fill()):(Ut.lineCap="round",Ut.lineWidth=e.t,Ut.strokeStyle=Object(n.c)(e.c),Ut.stroke())},Lt=(e,t,a,r)=>{Ut.beginPath(),t===a?Ut.arc(e.x,e.y,t,0,2*Math.PI,!1):(Ut.save(),Ut.translate(e.x-t,e.y-a),Ut.scale(t,a),Ut.arc(1,1,1,0,2*Math.PI,!1),Ut.restore()),r?(Ut.fillStyle=Object(n.c)(e.c),Ut.fill()):(Ut.lineWidth=e.t,Ut.strokeStyle=Object(n.c)(e.c),Ut.stroke())},Pt=(e,t,a,r,o)=>{Ut.beginPath(),Ut.moveTo(e.x,e.y),Ut.lineTo(t,e.y),Ut.lineTo(t,a),Ut.lineTo(e.x,a),Ut.closePath(),Ut.fillStyle=Object(n.c)(r),Ut.fill(),o&&(Ut.lineCap="round",Ut.lineWidth=e.t,Ut.strokeStyle=Object(n.c)(e.c),Ut.stroke())},Ct=(e,t)=>{const a=Ut.getImageData(e,t,1,1);return 65536*a.data[0]+256*a.data[1]+a.data[2]},It=(e,t,a,n)=>{const r=Ut.createImageData(1,1);r.data[0]=a>>16&255,r.data[1]=a>>8&255,r.data[2]=255&a,r.data[3]=255,Ut.putImageData(r,e,t),n&&(Ut.putImageData(r,e-1,t),Ut.putImageData(r,e,t-1),Ut.putImageData(r,e-1,t-1))},Mt=e=>{Ut.fillStyle=Object(n.c)(e),Ut.fillRect(0,0,Bt.width,Bt.height)},At=(e,t,a,n,r)=>{const o=Ut.getImageData(0,0,Bt.width,Bt.height),s=[],i=[0,-1,1,0],l=[-1,0,0,1];let c=0,d=4*(t*Bt.width+e);const u=65536*o.data[d]+256*o.data[d+1]+o.data[d+2];let p,m,h,g,b,f,y=e,x=t;for(s.push(y),s.push(x);s.length>0;)for(x=s.pop(),y=s.pop(),c=0;c<4;c+=1)m=x+l[c],g=(p=y+i[c])>0&&p<=Bt.width,b=m>0&&m<=Bt.height,g&&b&&(d=4*(m*Bt.width+p),h=65536*o.data[d],h+=256*o.data[d+1],g=(h+=o.data[d+2])!==a,b=h!==n||!r,g&&b&&(f=h===u||r)&&(d=4*(m*Bt.width+p),o.data[d]=(16711680&a)>>16,o.data[d+1]=(65280&a)>>8,o.data[d+2]=255&a,s.push(p),s.push(m)));Ut.putImageData(o,0,0)},Nt=e=>{qt.innerHTML+=e,Gt.innerHTML+=e},Dt=(e,t)=>{e&&(qt.innerHTML=""),qt.style.background=Object(n.c)(t)},Ft=(e,t)=>{e&&(Gt.innerHTML=""),Gt.style.background=Object(n.c)(t)};let Bt,Ut,Gt,qt;const Ht=(e,t)=>{Yt[e]=t},jt=()=>Xt.running,$t=()=>{return{stack:Vt.slice(0,aa.stackTop+1),heap:Vt.slice(aa.heapBase,aa.heapMax)}},Wt=(e,t)=>{Bt=document.querySelector(".tsx-canvas"),Ut=Bt.getContext("2d"),Gt=document.querySelector(".tsx-console"),qt=document.querySelector(".tsx-output"),Tt(1e3,1e3),Ft(!0,16777215),Dt(!0,16777215),t.showCanvas&&Yt.show("canvas"),Vt.length=2097152,Kt.length=256,Qt.length=16,Vt.fill(0),Kt.fill(-1),Qt.fill(-1),_t.length=0,Zt.length=0,Jt.length=0,ea.length=0,ta.length=0,aa.stackTop=0,aa.heapGlobal=-1,aa.heapBase=t.stackSize-1,aa.heapTemp=aa.heapBase,aa.heapPerm=aa.heapTemp,aa.heapMax=aa.heapTemp,na.startx=0,na.starty=0,na.sizex=1e3,na.sizey=1e3,na.width=1e3,na.height=1e3,na.degrees=360,na.doubled=!1,ra.startTime=Date.now(),ra.pendown=!0,ra.update=!0,ra.keyecho=!0,ra.input="",ra.detect=null,ra.readline=null,Xt.running=!0,Xt.paused=!1,window.addEventListener("keydown",oa),window.addEventListener("keyup",sa),window.addEventListener("keypress",ia),wt("contextmenu",ua),wt("mousemove",la),wt("touchmove",ua),wt("touchmove",la),wt("mousedown",ua),wt("mousedown",ca),wt("touchstart",ca),wt("mouseup",da),wt("touchend",da),Yt.run(),pa(e,0,0,t)},zt=()=>{window.removeEventListener("keydown",oa),window.removeEventListener("keyup",sa),window.removeEventListener("keypress",ia),vt("contextmenu",ua),vt("mousemove",la),vt("touchmove",ua),vt("touchmove",la),vt("mousedown",ua),vt("mousedown",ca),vt("touchstart",ca),vt("mouseup",da),vt("touchend",da),Et(1),Xt.running=!1,Xt.paused=!1,Yt.halt()},Yt={},Xt={running:!1,paused:!1},Vt=[],Kt=[],Qt=[],_t=[],Zt=[],Jt=[],ea=[],ta=[],aa={},na={},ra={},oa=e=>{const t=e.keyCode||e.charCode;if(8===t){e.preventDefault();const t=Vt[1],a=Vt[t+1],n=Vt[t+2];a<n&&(Vt[n]=0,Vt[t+2]-=1),ra.input=ra.input.slice(0,-1),ra.keyecho&&(Gt.innerHTML=Gt.innerHTML.slice(0,-1))}t>=37&&t<=40&&e.preventDefault(),Qt[9]=t,Qt[10]=128,e.shiftKey&&(Qt[10]+=8),e.altKey&&(Qt[10]+=16),e.ctrlKey&&(Qt[10]+=32),Kt[t]=Qt[10]},sa=e=>{const t=e.keyCode||e.charCode;Qt[9]=-Qt[9],Qt[10]=-Qt[10],Kt[t]=-Kt[t]},ia=e=>{const t=e.keyCode||e.charCode,a=Vt[1];if(a>0){let e=0;(e=Vt[a+2]===Vt[a]?a+3:Vt[a+2]+1)!==Vt[a+1]&&(Vt[Vt[a+2]]=t,Vt[a+2]=e)}ra.keyecho&&(e=>{Gt.innerHTML+=e})(String.fromCharCode(t))},la=e=>{switch(e.type){case"mousemove":Qt[7]=Sa(e.clientX),Qt[8]=Ra(e.clientY);break;case"touchmove":case"touchstart":Qt[7]=Sa(e.touches[0].clientX),Qt[8]=Ra(e.touches[0].clientY)}},ca=e=>{const t=Date.now();switch(Qt[4]=128,e.shiftKey&&(Qt[4]+=8),e.altKey&&(Qt[4]+=16),e.ctrlKey&&(Qt[4]+=32),t-Qt[11]<300&&(Qt[4]+=64),Qt[11]=t,e.type){case"mousedown":switch(Qt[5]=Sa(e.clientX),Qt[6]=Ra(e.clientY),e.button){case 0:Qt[4]+=1,Qt[1]=Qt[4],Qt[2]=-1,Qt[3]=-1;break;case 1:Qt[4]+=4,Qt[1]=-1,Qt[2]=-1,Qt[3]=Qt[4];break;case 2:Qt[4]+=2,Qt[1]=-1,Qt[2]=Qt[4],Qt[3]=-1}break;case"touchstart":Qt[5]=Sa(e.touches[0].clientX),Qt[6]=Ra(e.touches[0].clientY),Qt[4]+=1,Qt[1]=Qt[4],Qt[2]=-1,Qt[3]=-1,la(e)}},da=e=>{switch(Qt[4]=-Qt[4],e.type){case"mouseup":switch(e.button){case 0:Qt[1]=-Qt[1];break;case 1:Qt[2]=-Qt[3];break;case 2:Qt[2]=-Qt[2]}break;case"touchend":Qt[1]=-Qt[1]}},ua=e=>{e.preventDefault()},pa=(e,t,a,n)=>{if(!Xt.running)return;if(Xt.paused)return void setTimeout(pa,1,e,t,a,n);window.removeEventListener("keypress",ra.detect),window.removeEventListener("keypress",ra.readline);let o,s,i,l,c=0,d=0;for(;c<n.drawCountMax&&d<=n.codeCountMax;){switch(e[t][a]){case R.a.dupl:o=Zt.pop(),Zt.push(o,o);break;case R.a.swap:s=Zt.pop(),o=Zt.pop(),Zt.push(s,o);break;case R.a.rota:i=Zt.pop(),s=Zt.pop(),o=Zt.pop(),Zt.push(s,i,o);break;case R.a.incr:o=Zt.pop(),Zt.push(o+1);break;case R.a.decr:o=Zt.pop(),Zt.push(o-1);break;case R.a.not:o=Zt.pop(),Zt.push(~o);break;case R.a.and:s=Zt.pop(),o=Zt.pop(),Zt.push(o&s);break;case R.a.or:s=Zt.pop(),o=Zt.pop(),Zt.push(o|s);break;case R.a.xor:s=Zt.pop(),o=Zt.pop(),Zt.push(o^s);break;case R.a.neg:o=Zt.pop(),Zt.push(-o);break;case R.a.abs:o=Zt.pop(),Zt.push(Math.abs(o));break;case R.a.sign:o=Zt.pop(),Zt.push(Math.sign(o));break;case R.a.rand:o=Zt.pop(),Zt.push(Math.floor(Math.random()*Math.abs(o)));break;case R.a.plus:s=Zt.pop(),o=Zt.pop(),Zt.push(o+s);break;case R.a.subt:s=Zt.pop(),o=Zt.pop(),Zt.push(o-s);break;case R.a.mult:s=Zt.pop(),o=Zt.pop(),Zt.push(o*s);break;case R.a.divr:s=Zt.pop(),o=Zt.pop(),Zt.push(Math.round(o/s));break;case R.a.div:s=Zt.pop(),o=Zt.pop(),Zt.push(Math.floor(o/s));break;case R.a.mod:s=Zt.pop(),o=Zt.pop(),Zt.push(o%s);break;case R.a.divm:i=Zt.pop(),s=Zt.pop(),o=Zt.pop(),Zt.push(Math.round(o/s*i));break;case R.a.sqrt:s=Zt.pop(),o=Zt.pop(),Zt.push(Math.round(Math.sqrt(o)*s));break;case R.a.hyp:i=Zt.pop(),s=Zt.pop(),o=Zt.pop(),Zt.push(Math.round(Math.sqrt(o*o+s*s)*i));break;case R.a.root:l=Zt.pop(),i=Zt.pop(),s=Zt.pop(),o=Zt.pop(),Zt.push(Math.round(Math.pow(o/s,1/i)*l));break;case R.a.powr:l=Zt.pop(),i=Zt.pop(),s=Zt.pop(),o=Zt.pop(),Zt.push(Math.round(Math.pow(o/s,i)*l));break;case R.a.log:i=Zt.pop(),s=Zt.pop(),o=Zt.pop(),Zt.push(Math.round(Math.log(o/s)/Math.LN10*i));break;case R.a.alog:i=Zt.pop(),s=Zt.pop(),o=Zt.pop(),Zt.push(Math.round(Math.pow(10,o/s)*i));break;case R.a.ln:i=Zt.pop(),s=Zt.pop(),o=Zt.pop(),Zt.push(Math.round(Math.log(o/s)*i));break;case R.a.exp:i=Zt.pop(),s=Zt.pop(),o=Zt.pop(),Zt.push(Math.round(Math.exp(o/s)*i));break;case R.a.sin:l=Zt.pop(),i=Zt.pop(),o=(s=Zt.pop())/i*(2*Math.PI)/na.degrees,Zt.push(Math.round(Math.sin(o)*l));break;case R.a.cos:l=Zt.pop(),i=Zt.pop(),o=(s=Zt.pop())/i*(2*Math.PI)/na.degrees,Zt.push(Math.round(Math.cos(o)*l));break;case R.a.tan:l=Zt.pop(),i=Zt.pop(),o=(s=Zt.pop())/i*(2*Math.PI)/na.degrees,Zt.push(Math.round(Math.tan(o)*l));break;case R.a.asin:l=Zt.pop(),i=Zt.pop(),s=Zt.pop(),o=na.degrees/(2*Math.PI),Zt.push(Math.round(Math.asin(s/i)*l*o));break;case R.a.acos:l=Zt.pop(),i=Zt.pop(),s=Zt.pop(),o=na.degrees/(2*Math.PI),Zt.push(Math.round(Math.acos(s/i)*l*o));break;case R.a.atan:l=Zt.pop(),i=Zt.pop(),s=Zt.pop(),o=na.degrees/(2*Math.PI),Zt.push(Math.round(Math.atan2(s,i)*l*o));break;case R.a.pi:o=Zt.pop(),Zt.push(Math.round(Math.PI*o));break;case R.a.ctos:o=Zt.pop(),ha(String.fromCharCode(o));break;case R.a.itos:o=Zt.pop(),ha(o.toString());break;case R.a.hexs:for(s=Zt.pop(),o=Zt.pop().toString(16).toUpperCase();o.length<s;)o="0"+o;ha(o);break;case R.a.sval:i=Zt.pop(),s=Zt.pop(),o=ga(s),l="#"===o[0]?isNaN(parseInt(o.slice(1),16))?i:parseInt(o.slice(1),16):isNaN(parseInt(o,10))?i:parseInt(o,10),Zt.push(l);break;case R.a.qtos:l=Zt.pop(),i=Zt.pop(),s=Zt.pop(),ha((o=s/i).toFixed(l));break;case R.a.qval:i=Zt.pop(),s=Zt.pop(),o=ga(Zt.pop()),l=isNaN(parseFloat(o))?i:parseFloat(o),Zt.push(Math.round(l*s));break;case R.a.scat:s=ga(Zt.pop()),o=ga(Zt.pop()),ha(o+s);break;case R.a.slen:o=ga(Zt.pop()),Zt.push(o.length);break;case R.a.case:s=Zt.pop(),o=ga(Zt.pop()),ha(s>0?o.toUpperCase():s<0?o.toLowerCase():o);break;case R.a.copy:i=Zt.pop(),s=Zt.pop(),o=ga(Zt.pop()),ha(o.substr(s-1,i));break;case R.a.dels:l=Zt.pop(),i=Zt.pop(),o=(s=ga(Zt.pop())).substr(0,i-1)+s.substr(i-1+l),ha(o);break;case R.a.inss:l=Zt.pop(),i=ga(Zt.pop()),s=ga(Zt.pop()),o=i.substr(0,l-1)+s+i.substr(l-1),ha(o);break;case R.a.poss:s=ga(Zt.pop()),o=ga(Zt.pop()),Zt.push(s.indexOf(o)+1);break;case R.a.repl:if(l=Zt.pop(),i=ga(Zt.pop()),s=ga(Zt.pop()),o=ga(Zt.pop()),l>0){for(;l>0;)o=o.replace(s,i),l-=1;ha(o)}else ha(o.replace(new RegExp(s,"g"),i));break;case R.a.eqal:s=Zt.pop(),o=Zt.pop(),Zt.push(o===s?-1:0);break;case R.a.noeq:s=Zt.pop(),o=Zt.pop(),Zt.push(o!==s?-1:0);break;case R.a.less:s=Zt.pop(),o=Zt.pop(),Zt.push(o<s?-1:0);break;case R.a.more:s=Zt.pop(),o=Zt.pop(),Zt.push(o>s?-1:0);break;case R.a.lseq:s=Zt.pop(),o=Zt.pop(),Zt.push(o<=s?-1:0);break;case R.a.mreq:s=Zt.pop(),o=Zt.pop(),Zt.push(o>=s?-1:0);break;case R.a.maxi:s=Zt.pop(),o=Zt.pop(),Zt.push(Math.max(o,s));break;case R.a.mini:s=Zt.pop(),o=Zt.pop(),Zt.push(Math.min(o,s));break;case R.a.seql:s=ga(Zt.pop()),o=ga(Zt.pop()),Zt.push(o===s?-1:0);break;case R.a.sneq:s=ga(Zt.pop()),o=ga(Zt.pop()),Zt.push(o!==s?-1:0);break;case R.a.sles:s=ga(Zt.pop()),o=ga(Zt.pop()),Zt.push(o<s?-1:0);break;case R.a.smor:s=ga(Zt.pop()),o=ga(Zt.pop()),Zt.push(o>s?-1:0);break;case R.a.sleq:s=ga(Zt.pop()),o=ga(Zt.pop()),Zt.push(o<=s?-1:0);break;case R.a.smeq:s=ga(Zt.pop()),o=ga(Zt.pop()),Zt.push(o>=s?-1:0);break;case R.a.smax:s=ga(Zt.pop()),o=ga(Zt.pop()),ha(Math.max(o,s));break;case R.a.smin:s=ga(Zt.pop()),o=ga(Zt.pop()),ha(Math.min(o,s));break;case R.a.ldin:o=e[t][a+1],Zt.push(o),a+=1;break;case R.a.ldvg:o=e[t][a+1],Zt.push(Vt[o]),a+=1;break;case R.a.ldvv:o=e[t][a+1],s=e[t][a+2],Zt.push(Vt[Vt[o]+s]),a+=2;break;case R.a.ldvr:o=e[t][a+1],s=e[t][a+2],Zt.push(Vt[Vt[Vt[o]+s]]),a+=2;break;case R.a.ldag:o=e[t][a+1],Zt.push(o),a+=1;break;case R.a.ldav:o=e[t][a+1],s=e[t][a+2],Zt.push(Vt[o]+s),a+=2;break;case R.a.lstr:for(s=(a+=1)+(o=e[t][a]),i="";a<s;)a+=1,i+=String.fromCharCode(e[t][a]);ha(i);break;case R.a.ldmt:Zt.push(Jt.length-1);break;case R.a.zero:o=e[t][a+1],s=e[t][a+2],Vt[Vt[o]+s]=0,a+=2;break;case R.a.stvg:o=Zt.pop(),Vt[e[t][a+1]]=o,a+=1;break;case R.a.stvv:o=e[t][a+1],s=e[t][a+2],i=Zt.pop(),Vt[Vt[o]+s]=i,a+=2;break;case R.a.stvr:o=e[t][a+1],s=e[t][a+2],i=Zt.pop(),Vt[Vt[Vt[o]+s]]=i,a+=2;break;case R.a.stmt:o=Zt.pop(),Jt.push(o),aa.stackTop=Math.max(o,aa.stackTop);break;case R.a.lptr:o=Zt.pop(),Zt.push(Vt[o]);break;case R.a.sptr:s=Zt.pop(),o=Zt.pop(),Vt[s]=o;break;case R.a.cptr:i=Zt.pop(),s=Zt.pop(),o=Zt.pop(),fa(o,s,i);break;case R.a.zptr:s=Zt.pop(),o=Zt.pop(),ba(o,s);break;case R.a.test:break;case R.a.cstr:s=Zt.pop(),o=Zt.pop(),l=Vt[s-1],i=Vt[o],fa(o,s,Math.min(i,l)+1);break;case R.a.jump:t=e[t][a+1]-1,a=-1;break;case R.a.ifno:0===Zt.pop()?(t=e[t][a+1]-1,a=-1):a+=1;break;case R.a.halt:return void zt();case R.a.subr:-1===aa.heapGlobal&&(aa.heapGlobal=aa.heapPerm),ea.push(t+1),t=e[t][a+1]-1,a=-1;break;case R.a.retn:t=ea.pop(),a=-1;break;case R.a.pssr:ta.push(e[t][a+1]),a+=1;break;case R.a.plsr:ta.pop();break;case R.a.psrj:Zt.push(t+1);break;case R.a.plrj:ea.pop(),t=Zt.pop()-1,a=-1;break;case R.a.memc:if(o=e[t][a+1],s=e[t][a+2],(i=Jt.pop())+s>n.stackSize)throw zt(),ma("Memory stack has overflowed into memory heap. Probable cause is unterminated recursion.");Jt.push(Vt[o]),aa.stackTop=Math.max(Vt[o],aa.stackTop),Vt[o]=i,Jt.push(i+s),aa.stackTop=Math.max(i+s,aa.stackTop),a+=2;break;case R.a.memr:Jt.pop(),o=e[t][a+1],s=Jt.pop(),Jt.push(Vt[o]),aa.stackTop=Math.max(Vt[o],aa.stackTop),Vt[o]=s,a+=2;break;case R.a.hfix:aa.heapPerm=aa.heapTemp;break;case R.a.hclr:aa.heapTemp=aa.heapPerm;break;case R.a.hrst:aa.heapGlobal>-1&&(aa.heapTemp=aa.heapGlobal,aa.heapPerm=aa.heapGlobal);break;case R.a.pnup:ra.pendown=!1;break;case R.a.pndn:ra.pendown=!0;break;case R.a.udat:ra.update=!0,c=n.drawCountMax;break;case R.a.ndat:ra.update=!1;break;case R.a.kech:o=-1===Zt.pop(),ra.keyecho=o;break;case R.a.outp:i=-1===Zt.pop(),s=Zt.pop(),o=-1===Zt.pop(),Dt(o,s),i?Yt.show("output"):Yt.show("canvas");break;case R.a.cons:s=Zt.pop(),o=-1===Zt.pop(),Ft(o,s);break;case R.a.trac:case R.a.memw:Zt.pop();break;case R.a.dump:Yt.dump($t()),n.showMemory&&Yt.show("memory");break;case R.a.time:o=Date.now(),o-=ra.startTime,Zt.push(o);break;case R.a.tset:o=Date.now(),s=Zt.pop(),ra.startTime=o-s;break;case R.a.wait:return o=Zt.pop(),(a+=1)===e[t].length&&(t+=1,a=0),void setTimeout(pa,o,e,t,a,n);case R.a.tdet:return s=Zt.pop(),o=Zt.pop(),Zt.push(0),(a+=1)===e[t].length&&(t+=1,a=0),i=setTimeout(pa,o,e,t,a,n),ra.detect=ya.bind(null,s,i,e,t,a,n),void window.addEventListener("keyup",ra.detect);case R.a.inpt:(o=Zt.pop())<0?Zt.push(Qt[-o]):Zt.push(Kt[o]);break;case R.a.iclr:(o=Zt.pop())<0?Qt[-o]=-1:Kt[o]=-1;break;case R.a.bufr:(o=Zt.pop())>0&&(s=aa.heapTemp+4,Zt.push(aa.heapTemp+1),Vt[aa.heapTemp+1]=s+o,Vt[aa.heapTemp+2]=s,Vt[aa.heapTemp+3]=s,Vt.fill(0,s,s+o),aa.heapTemp=s+o,aa.heapMax=Math.max(aa.heapTemp,aa.heapMax));break;case R.a.read:o=Zt.pop(),s=Vt[1],i="",l="";let d=!1;for(;o>0&&!d;)Vt[s+1]===Vt[s+2]?d=!0:(l=Vt[Vt[s+1]],i+=String.fromCharChode(l),Vt[s+1]+=1),o-=1;ha(i);break;case R.a.rdln:return o=Math.pow(2,31)-1,(a+=1)===e[t].length&&(t+=1,a=0),s=setTimeout(pa,o,e,t,a,n),ra.readline=xa.bind(null,s,e,t,a,n),void window.addEventListener("keypress",ra.readline);case R.a.prnt:i=Zt.pop(),s=Zt.pop(),o=ga(Zt.pop()),St(wa(),o,s,i);break;case R.a.text:o=ga(Zt.pop()),Nt(o),n.showOutput&&Yt.show("output");break;case R.a.newl:Nt("\n");break;case R.a.fdir:case R.a.open:case R.a.clos:case R.a.fptr:case R.a.fbeg:case R.a.eof:case R.a.frds:case R.a.frln:case R.a.fwrs:case R.a.fwnl:break;case R.a.canv:na.sizey=Zt.pop(),na.sizex=Zt.pop(),na.starty=Zt.pop(),na.startx=Zt.pop(),Vt[Vt[0]+1]=Math.round(na.startx+na.sizex/2),Vt[Vt[0]+2]=Math.round(na.starty+na.sizey/2),Vt[Vt[0]+3]=0,Yt.turtx(Vt[Vt[0]+1]),Yt.turty(Vt[Vt[0]+2]),Yt.turtd(Vt[Vt[0]+3]),_t.push([Vt[Vt[0]+1],Vt[Vt[0]+2]]),c=n.drawCountMax;break;case R.a.reso:s=Zt.pop(),o=Zt.pop(),Math.min(o,s)<n.smallSize&&(o*=2,s*=2,na.doubled=!0),na.width=o,na.height=s,Tt(o,s),Mt(16777215),c=n.drawCountMax;break;case R.a.pixc:s=Zt.pop(),o=Zt.pop(),Zt.push(Ct(va(o),ka(s)));break;case R.a.pixs:i=Zt.pop(),s=Zt.pop(),o=Zt.pop(),It(va(o),ka(s),i,na.doubled),ra.update&&(c+=1);break;case R.a.angl:o=Zt.pop(),s=Math.round(o+Vt[Vt[0]+3]*o/na.degrees),Vt[Vt[0]+3]=s%o,Yt.turtd(Vt[Vt[0]+3]),na.degrees=o;break;case R.a.curs:o=Zt.pop(),Et(o);break;case R.a.home:o=na.startx+na.sizex/2,s=na.starty+na.sizey/2,Vt[Vt[0]+1]=Math.round(o),Vt[Vt[0]+2]=Math.round(s),Vt[Vt[0]+3]=0,Yt.turtx(Vt[Vt[0]+1]),Yt.turty(Vt[Vt[0]+2]),Yt.turtd(Vt[Vt[0]+3]),_t.push([Vt[Vt[0]+1],Vt[Vt[0]+2]]);break;case R.a.setx:o=Zt.pop(),Vt[Vt[0]+1]=o,Yt.turtx(o),_t.push([Vt[Vt[0]+1],Vt[Vt[0]+2]]);break;case R.a.sety:o=Zt.pop(),Vt[Vt[0]+2]=o,Yt.turty(o),_t.push([Vt[Vt[0]+1],Vt[Vt[0]+2]]);break;case R.a.setd:o=Zt.pop()%na.degrees,Vt[Vt[0]+3]=o,Yt.turtd(o);break;case R.a.thik:o=Zt.pop(),Vt[Vt[0]+4]=o,Yt.turtt(o);break;case R.a.colr:o=Zt.pop(),Vt[Vt[0]+5]=o,Yt.turtc(o);break;case R.a.rgb:o=Zt.pop(),(o%=50)<=0&&(o+=50),o=r.a[o-1].value,Zt.push(o);break;case R.a.mixc:l=Zt.pop(),i=Zt.pop(),s=Zt.pop();const u=(e,t)=>Math.round((e*i+t*l)/(i+l)),p=e=>Math.floor(e/65536),m=e=>Math.floor((65280&e)/256),h=e=>255&e,g=u(p(o=Zt.pop()),p(s)),b=u(m(o),m(s)),f=u(h(o),h(s));Zt.push(65536*g+256*b+f);break;case R.a.toxy:s=Zt.pop(),o=Zt.pop(),Vt[Vt[0]+1]=o,Vt[Vt[0]+2]=s,Yt.turtx(o),Yt.turty(s),_t.push([o,s]);break;case R.a.mvxy:s=Zt.pop()+Vt[Vt[0]+2],o=Zt.pop()+Vt[Vt[0]+1],Vt[Vt[0]+1]=o,Vt[Vt[0]+2]=s,Yt.turtx(o),Yt.turty(s),_t.push([o,s]);break;case R.a.drxy:s=Zt.pop()+Vt[Vt[0]+2],o=Zt.pop()+Vt[Vt[0]+1],ra.pendown&&(Rt(wa(),va(o),ka(s)),ra.update&&(c+=1)),Vt[Vt[0]+1]=o,Vt[Vt[0]+2]=s,Yt.turtx(o),Yt.turty(s),_t.push([o,s]);break;case R.a.fwrd:i=Zt.pop(),s=Vt[Vt[0]+3],s=Math.cos(s*Math.PI/(na.degrees/2)),s=-Math.round(s*i),s+=Vt[Vt[0]+2],o=Vt[Vt[0]+3],o=Math.sin(o*Math.PI/(na.degrees/2)),o=Math.round(o*i),o+=Vt[Vt[0]+1],ra.pendown&&(Rt(wa(),va(o),ka(s)),ra.update&&(c+=1)),Vt[Vt[0]+1]=o,Vt[Vt[0]+2]=s,Yt.turtx(o),Yt.turty(s),_t.push([o,s]);break;case R.a.back:i=Zt.pop(),s=Vt[Vt[0]+3],s=Math.cos(s*Math.PI/(na.degrees/2)),s=Math.round(s*i),s+=Vt[Vt[0]+2],o=Vt[Vt[0]+3],o=Math.sin(o*Math.PI/(na.degrees/2)),o=-Math.round(o*i),o+=Vt[Vt[0]+1],ra.pendown&&(Rt(wa(),va(o),ka(s)),ra.update&&(c+=1)),Vt[Vt[0]+1]=o,Vt[Vt[0]+2]=s,Yt.turtx(o),Yt.turty(s),_t.push([o,s]);break;case R.a.left:o=(Vt[Vt[0]+3]-Zt.pop())%na.degrees,Vt[Vt[0]+3]=o,Yt.turtd(o);break;case R.a.rght:o=(Vt[Vt[0]+3]+Zt.pop())%na.degrees,Vt[Vt[0]+3]=o,Yt.turtd(o);break;case R.a.turn:s=Zt.pop(),o=Zt.pop(),Math.abs(s)>=Math.abs(o)?(i=Math.atan(-o/s),s>0?i+=Math.PI:o<0&&(i+=2,i*=Math.PI)):(i=Math.atan(s/o),o>0?i+=Math.PI:(i+=3,i*=Math.PI),i/=2),i=Math.round(i*na.degrees/Math.PI/2)%na.degrees,Vt[Vt[0]+3]=i,Yt.turtd(i);break;case R.a.rmbr:_t.push([Vt[Vt[0]+1],Vt[Vt[0]+2]]);break;case R.a.frgt:_t.length-=Zt.pop();break;case R.a.poly:i=Zt.pop(),s=_t.length,o=i>s?0:s-i,Ot(wa(),_t.slice(o,s).map(Ea),!1),ra.update&&(c+=1);break;case R.a.pfil:i=Zt.pop(),s=_t.length,o=i>s?0:s-i,Ot(wa(),_t.slice(o,s).map(Ea),!0),ra.update&&(c+=1);break;case R.a.circ:o=Zt.pop(),Lt(wa(),va(o+na.startx),ka(o+na.starty),!1),ra.update&&(c+=1);break;case R.a.blot:o=Zt.pop(),Lt(wa(),va(o+na.startx),ka(o+na.starty),!0),ra.update&&(c+=1);break;case R.a.elps:s=Zt.pop(),o=Zt.pop(),Lt(wa(),va(o+na.startx),ka(s+na.starty),!1),ra.update&&(c+=1);break;case R.a.eblt:s=Zt.pop(),o=Zt.pop(),Lt(wa(),va(o+na.startx),ka(s+na.starty),!0),ra.update&&(c+=1);break;case R.a.box:l=-1===Zt.pop(),i=Zt.pop(),s=Vt[Vt[0]+2]+Zt.pop(),o=Vt[Vt[0]+1]+Zt.pop(),Pt(wa(),va(o),ka(s),i,l),ra.update&&(c+=1);break;case R.a.blnk:o=Zt.pop(),Mt(o),ra.update&&(c+=1);break;case R.a.rcol:i=Zt.pop(),s=Zt.pop(),o=Zt.pop(),At(o,s,i,0,!1),ra.update&&(c+=1);break;case R.a.fill:l=Zt.pop(),i=Zt.pop(),s=Zt.pop(),o=Zt.pop(),At(o,s,i,l,!0),ra.update&&(c+=1);break;case R.a.mxin:Zt.push(Math.pow(2,31)-1)}if(d+=1,a+=1,!e[t])throw zt(),ma("The program has tried to jump to a line that does not exist. This is either a bug in our compiler, or in your assembled code.");a===e[t].length&&(t+=1,a=0)}setTimeout(pa,0,e,t,a,n)},ma=e=>{const t=new Error(e);return t.type="Machine",t},ha=e=>{const t=Array.from(e).map(e=>e.charCodeAt(0));Zt.push(aa.heapTemp+1),aa.heapTemp+=1,Vt[aa.heapTemp]=e.length,t.forEach(e=>{aa.heapTemp+=1,Vt[aa.heapTemp]=e}),aa.heapMax=Math.max(aa.heapTemp,aa.heapMax)},ga=e=>{const t=Vt[e],a=e+1,n=Vt.slice(a,a+t).reduce((e,t)=>e+String.fromCharCode(t),"");return e+t+1>aa.heapPerm&&(aa.heapTemp=e+t),n},ba=(e,t)=>{t>0&&(Vt[e]=0,ba(e+1,t-1))},fa=(e,t,a)=>{a>0&&(Vt[t]=Vt[e],fa(e+1,t+1,a-1))},ya=(e,t,a,n,r,o,s)=>{(s.keyCode||s.charCode)===e&&(Zt.pop(),Zt.push(-1),window.clearTimeout(t),pa(a,n,r,o))},xa=(e,t,a,n,r,o)=>{const s=o.keyCode||o.charCode;13===s?(ha(ra.input),ra.input="",window.clearTimeout(e),pa(t,a,n,r)):8===s?ra.input=ra.input.slice(0,-1):ra.input+=String.fromCharCode(s)},wa=()=>({x:va(Vt[Vt[0]+1]),y:ka(Vt[Vt[0]+2]),d:Vt[Vt[0]+3],t:Ta(Vt[Vt[0]+4]),c:Vt[Vt[0]+5]}),va=e=>{const t=(e-na.startx)*na.width/na.sizex;return na.doubled?Math.round(t)+1:Math.round(t)},ka=e=>{const t=(e-na.starty)*na.height/na.sizey;return na.doubled?Math.round(t)+1:Math.round(t)},Ta=e=>na.doubled?2*e:e,Ea=([e,t])=>[va(e),ka(t)],Sa=e=>{const{left:t,width:a}=kt(),n=(e-t)*na.sizex/a+na.startx;return Math.round(n)},Ra=e=>{const{height:t,top:a}=kt(),n=(e-a)*na.sizey/t+na.starty;return Math.round(n)};a.d(t,"b",function(){return Oa}),a.d(t,"a",function(){return La});const Oa=(e,t)=>{try{switch(e){case"ready":Pa("language-changed",Ma("language")),Pa("show-canvas-changed",Ma("show-canvas")),Pa("show-output-changed",Ma("show-output")),Pa("show-memory-changed",Ma("show-memory")),Pa("draw-count-max-changed",Ma("draw-count-max")),Pa("code-count-max-changed",Ma("code-count-max")),Pa("small-size-changed",Ma("small-size")),Pa("stack-size-changed",Ma("stack-size")),Pa("group-changed",Ma("group")),Pa("simple-changed",Ma("simple")),Pa("intermediate-changed",Ma("intermediate")),Pa("advanced-changed",Ma("advanced"));break;case"new-program":Ia("name",""),Ia("compiled",!1),Ia("code",""),Ia("usage",[]),Ia("pcode",[]),Pa("file-changed");break;case"new-skeleton-program":switch(Ia("name","Skeleton program"),Ia("compiled",!1),Ia("usage",[]),Ia("pcode",[]),Ma("language")){case"BASIC":Ia("code","REM progname\n\nvar1%=100\nCOLOUR(GREEN)\nBLOT(var1%)\nEND");break;case"Pascal":Ia("code","PROGRAM progname;\nVAR var1: integer;\nBEGIN\n  var1:=100;\n  colour(green);\n  blot(var1)\nEND.");break;case"Python":Ia("code","# progname\n\ndef main():\n  var1=100\n  colour(green)\n  blot(var1)")}Pa("file-changed");break;case"save-program":const a=new window.Blob([Ma("code")],{type:"text/plain;charset=utf-8"}),s=document.createElement("a");s.setAttribute("href",URL.createObjectURL(a)),s.setAttribute("download",`${Ma("name")}.${r.c[Ma("language")]}`),s.click();break;case"save-tgx-program":Aa();const i=JSON.stringify(Ma("file")),l=new window.Blob([i],{type:"text/plain;charset=utf-8"}),c=document.createElement("a");c.setAttribute("href",URL.createObjectURL(l)),c.setAttribute("download",`${Ma("name")}.tgx`),c.click();break;case"set-language":Ia("language",t),Pa("language-changed",Ma("language"));break;case"set-example":r.f.forEach(e=>{Object(n.b)({url:`examples/${e}/${t}.${r.c[e]}`,success:a=>{Ia(`name-${e}`,o.names[t]),Ia(`compiled-${e}`,!1),Ia(`code-${e}`,a.trim()),Ia(`usage-${e}`,[]),Ia(`pcode-${e}`,[]),Pa("file-changed")},error:e=>{throw Na(`Failed to load example file (response code ${e}).`)}})});break;case"set-file":const d=t.filename.split("."),u=d.pop(),p=d.join(".");switch(u){case"tgb":Ia("language","BASIC"),Ia("name-BASIC",p),Ia("compiled-BASIC",!1),Ia("code-BASIC",t.content.trim()),Ia("usage-BASIC",[]),Ia("pcode-BASIC",[]);break;case"tgp":Ia("language","Pascal"),Ia("name-Pascal",p),Ia("compiled-Pascal",!1),Ia("code-Pascal",t.content.trim()),Ia("usage-Pascal",[]),Ia("pcode-Pascal",[]);break;case"tgy":Ia("language","Python"),Ia("name-Python",p),Ia("compiled-Python",!1),Ia("code-Python",t.content.trim()),Ia("usage-Python",[]),Ia("pcode-Python",[]);break;case"tgx":try{const e=JSON.parse(t.content);Ia("language",e.language),Ia(`name-${e.language}`,e.name),Ia(`compiled-${e.language}`,!0),Ia(`code-${e.language}`,e.code.trim()),Ia(`usage-${e.language}`,e.usage),Ia(`pcode-${e.language}`,e.pcode)}catch(e){throw Na("Invalid TGX file.")}break;default:throw Na("Invalid file type.")}Pa("language-changed",Ma("language"));break;case"set-name":Ia("name",t),Pa("name-changed",Ma("name"));break;case"set-code":Ia("code",t),Ia("compiled",!1),Pa("code-changed",{code:Ma("code"),language:Ma("language")});break;case"toggle-assembler":Ia("assembler",!Ma("assembler")),Pa("pcode-changed",{pcode:Ma("pcode"),assembler:Ma("assembler"),decimal:Ma("decimal")});break;case"toggle-decimal":Ia("decimal",!Ma("decimal")),Pa("pcode-changed",{pcode:Ma("pcode"),assembler:Ma("assembler"),decimal:Ma("decimal")});break;case"toggle-show-canvas":Ia("show-canvas",!Ma("show-canvas")),Pa("show-canvas-changed",Ma("show-canvas"));break;case"toggle-show-output":Ia("show-output",!Ma("show-output")),Pa("show-output-changed",Ma("show-output"));break;case"toggle-show-memory":Ia("show-memory",!Ma("show-memory")),Pa("show-memory-changed",Ma("show-memory"));break;case"show-settings":Pa("show-settings");break;case"set-draw-count-max":Ia("draw-count-max",t),Pa("draw-count-max-changed",Ma("draw-count-max"));break;case"set-code-count-max":Ia("code-count-max",t),Pa("code-count-max-changed",Ma("code-count-max"));break;case"set-small-size":Ia("small-size",t),Pa("small-size-changed",Ma("small-size"));break;case"set-stack-size":Ia("stack-size",t),Pa("stack-size-changed",Ma("stack-size"));break;case"reset-machine-options":Ia("show-canvas",!0),Ia("show-output",!1),Ia("show-memory",!0),Ia("draw-count-max",4),Ia("code-count-max",1e5),Ia("small-size",60),Ia("stack-size",2e4),Pa("show-canvas-changed",Ma("show-canvas")),Pa("show-output-changed",Ma("show-output")),Pa("show-memory-changed",Ma("show-memory")),Pa("draw-count-max-changed",Ma("draw-count-max")),Pa("code-count-max-changed",Ma("code-count-max")),Pa("small-size-changed",Ma("small-size")),Pa("stack-size-changed",Ma("stack-size"));break;case"set-group":Ia("group",t),Pa("help-options-changed",Ma("help-options"));break;case"toggle-simple":Ia("simple",!Ma("simple")),Pa("help-options-changed",Ma("help-options"));break;case"toggle-intermediate":Ia("intermediate",!Ma("intermediate")),Pa("help-options-changed",Ma("help-options"));break;case"toggle-advanced":Ia("advanced",!Ma("advanced")),Pa("help-options-changed",Ma("help-options"));break;case"machine-run-halt":jt()?zt():(Aa(),Wt(Ma("pcode"),Ma("machine-options")));break;case"machine-play-pause":jt()&&(Xt.paused?(Xt.paused=!1,Yt.play()):(Xt.paused=!0,Yt.pause()));break;case"dump-memory":Pa("dump-memory",$t());break;default:console.log(`unknown signal '${e}'`)}}catch(e){Pa("error",e)}},La=(e,t)=>{Ca[e]?Ca[e].push(t):Ca[e]=[t]},Pa=(e,t)=>{Ca[e]&&Ca[e].forEach(e=>e(t)),"language-changed"===e&&(Pa("file-changed"),Pa("help-options-changed",Ma("help-options"))),"file-changed"===e&&(Pa("name-changed",Ma("name")),Pa("code-changed",{code:Ma("code"),language:Ma("language")}),Pa("usage-changed",Ma("usage")),Pa("pcode-changed",{pcode:Ma("pcode"),assembler:Ma("assembler"),decimal:Ma("decimal")}))},Ca={},Ia=(e,t)=>{switch(e){case"name":case"compiled":case"code":case"usage":case"pcode":Ia(`${e}-${Ma("language")}`,t);break;default:window.localStorage.setItem(e,JSON.stringify(t))}},Ma=e=>{switch(e){case"name":case"compiled":case"code":case"usage":case"pcode":return Ma(`${e}-${Ma("language")}`);case"file":return{name:Ma("name"),compiled:Ma("compiled"),code:Ma("code"),usage:Ma("usage"),pcode:Ma("pcode")};case"machine-options":return{showCanvas:Ma("show-canvas"),showOutput:Ma("show-output"),showMemory:Ma("show-memory"),drawCountMax:Ma("draw-count-max"),codeCountMax:Ma("code-count-max"),smallSize:Ma("small-size"),stackSize:Ma("stack-size")};case"help-options":return{language:Ma("language"),group:Ma("group"),simple:Ma("simple"),intermediate:Ma("intermediate"),advanced:Ma("advanced")};default:return JSON.parse(window.localStorage.getItem(e))}},Aa=()=>{if(!Ma("compiled")){let e=xt(Ma("code"),Ma("language"));Ia("usage",e.usage),Ia("pcode",e.pcode),Ia("compiled",!0),Pa("usage-changed",e.usage),Pa("pcode-changed",{pcode:e.pcode,assembler:Ma("assembler"),decimal:Ma("decimal")})}},Na=e=>{const t=new Error(e);return t.type="System",t};null===Ma("language")&&Ia("language","Pascal"),r.f.forEach(e=>{null===Ma(`name-${e}`)&&Ia(`name-${e}`,""),null===Ma(`compiled-${e}`)&&Ia(`compiled-${e}`,!1),null===Ma(`code-${e}`)&&Ia(`code-${e}`,""),null===Ma(`usage-${e}`)&&Ia(`usage-${e}`,[]),null===Ma(`pcode-${e}`)&&Ia(`pcode-${e}`,[])}),null===Ma("assembler")&&Ia("assembler",!0),null===Ma("decimal")&&Ia("decimal",!0),null===Ma("show-canvas")&&Ia("show-canvas",!0),null===Ma("show-output")&&Ia("show-output",!1),null===Ma("show-memory")&&Ia("show-memory",!0),null===Ma("draw-count-max")&&Ia("draw-count-max",4),null===Ma("code-count-max")&&Ia("code-count-max",1e5),null===Ma("small-size")&&Ia("small-size",60),null===Ma("stack-size")&&Ia("stack-size",2e4),null===Ma("group")&&Ia("group",0),null===Ma("simple")&&Ia("simple",!0),null===Ma("intermediate")&&Ia("intermediate",!1),null===Ma("advanced")&&Ia("advanced",!1),Ht("run",()=>Pa("machine-started")),Ht("halt",()=>Pa("machine-stopped")),Ht("play",()=>Pa("machine-played")),Ht("pause",()=>Pa("machine-paused")),Ht("turtx",e=>Pa("turtx-changed",e)),Ht("turty",e=>Pa("turty-changed",e)),Ht("turtd",e=>Pa("turtd-changed",e)),Ht("turtt",e=>Pa("turtt-changed",e)),Ht("turtc",e=>Pa("turtc-changed",e)),Ht("show",e=>Pa(`show-${e}`)),Ht("dump",e=>Pa("dump-memory",e))},function(e,t,a){"use strict";a.d(t,"f",function(){return l}),a.d(t,"c",function(){return c}),a.d(t,"a",function(){return d}),a.d(t,"b",function(){return u}),a.d(t,"d",function(){return p}),a.d(t,"e",function(){return m});var n=a(1);const r=(e,t,a,r)=>({index:e,names:{BASIC:t.toUpperCase(),Pascal:t,Python:t},type:"integer",value:a,hex:{BASIC:`&${Object(n.d)(a.toString(16))}`,Pascal:`$${Object(n.d)(a.toString(16))}`,Python:`0x${Object(n.d)(a.toString(16))}`},css:`#${Object(n.d)(a.toString(16))}`,dark:r}),o=(e,t,a)=>({index:e,name:t,css:a}),s=(e,t,a)=>({index:e,name:t,css:a}),i=(e,t)=>({names:{BASIC:e.toUpperCase(),Pascal:e,Python:e},value:t}),l=["BASIC","Pascal","Python"],c={BASIC:"tgb",Pascal:"tgp",Python:"tgy"},d=[r(1,"green",2263842,!0),r(2,"red",16711680,!0),r(3,"blue",255,!0),r(4,"yellow",16776960,!1),r(5,"violet",9055202,!0),r(6,"lime",65280,!1),r(7,"orange",16755200,!1),r(8,"skyblue",45311,!1),r(9,"brown",9849600,!0),r(10,"pink",15602313,!0),r(11,"darkgreen",25600,!0),r(12,"darkred",11674146,!0),r(13,"darkblue",128,!0),r(14,"ochre",12628016,!0),r(15,"indigo",4915330,!0),r(16,"olive",8421376,!0),r(17,"orangered",16737792,!0),r(18,"teal",32896,!0),r(19,"darkbrown",6045747,!0),r(20,"magenta",16711935,!0),r(21,"lightgreen",10025880,!1),r(22,"lightred",13458524,!1),r(23,"lightblue",10075135,!1),r(24,"cream",16777147,!1),r(25,"lilac",11572223,!1),r(26,"yellowgreen",11193395,!1),r(27,"peach",16764080,!1),r(28,"cyan",65535,!1),r(29,"lightbrown",11567184,!1),r(30,"lightpink",16758465,!1),r(31,"seagreen",3978097,!1),r(32,"maroon",8388608,!0),r(33,"royal",4286945,!0),r(34,"gold",16762880,!1),r(35,"purple",8388736,!0),r(36,"emerald",51543,!1),r(37,"salmon",16416882,!1),r(38,"turquoise",48833,!1),r(39,"coffee",9596735,!1),r(40,"rose",16746666,!1),r(41,"greengrey",7377008,!0),r(42,"redgrey",11567232,!0),r(43,"bluegrey",8421536,!0),r(44,"yellowgrey",9474160,!0),r(45,"darkgrey",4210752,!0),r(46,"midgrey",8421504,!0),r(47,"lightgrey",10526880,!1),r(48,"silver",12632256,!1),r(49,"white",16777215,!1),r(50,"black",0,!0)],u=[o(0,"None","none"),o(1,"Default","default"),o(2,"Pointer","pointer"),o(3,"Crosshair","crosshair"),o(4,"Text","text"),o(5,"Move","move"),o(6,"Resize NESW","nesw-resize"),o(7,"Resize NS","ns-resize"),o(8,"Resize NWSE","nwse-resize"),o(9,"Resize EW","ew-resize"),o(10,"Resize N","n-resize"),o(11,"Wait","wait"),o(12,"Progress","progress"),o(13,"No Drop","no-drop"),o(14,"Forbidden","not-allowed"),o(15,"Help","help")],p=[s(0,"Arial","Arial, sans-serif"),s(1,"Arial Black",'"Arial Black", sans-serif'),s(2,"Comic Sans MS",'"Comic Sans MS", cursive, sans-serif'),s(3,"Courier New",'"Courier New", Courier, monospace'),s(4,"Georgia","Georgia, serif"),s(5,"Impact","Impact, Charcoal, sans-serif"),s(6,"Lucida Console",'"Lucida Console", monospace'),s(7,"Lucida Sans Unicode",'"Lucida Sans Unicode", sans-serif'),s(8,"Palatino Linotype",'"Palatino Linotype", "Book Antiqua", Palatino, serif'),s(9,"Symbol","Symbol"),s(10,"Tahoma","Tahoma, Geneva, sans-serif"),s(11,"Times New Roman",'"Times New Roman", Times, serif'),s(12,"Trebuchet MS",'"Trebuchet MS", helvetica, sans-serif'),s(13,"Verdana","Verdana, Geneva, sans-serif"),s(14,"Webdings","Webdings"),s(15,"Wingdings","Wingdings")],m=[i("?kshift",-10),i("?key",-9),i("?mousey",-8),i("?mousex",-7),i("?clicky",-6),i("?clickx",-5),i("?click",-4),i("?mmouse",-3),i("?rmouse",-2),i("?lmouse",-1),i("\\backspace",8),i("\\tab",9),i("\\enter",13),i("\\shift",16),i("\\ctrl",17),i("\\alt",18),i("\\pause",19),i("\\capslock",20),i("\\escape",27),i("\\space",32),i("\\pgup",33),i("\\pgdn",34),i("\\end",35),i("\\home",36),i("\\left",37),i("\\up",38),i("\\right",39),i("\\down",40),i("\\insert",45),i("\\delete",46),i("\\0",48),i("\\1",49),i("\\2",50),i("\\3",51),i("\\4",52),i("\\5",53),i("\\6",54),i("\\7",55),i("\\8",56),i("\\9",57),i("\\a",65),i("\\b",66),i("\\c",67),i("\\d",68),i("\\e",69),i("\\f",70),i("\\g",71),i("\\h",72),i("\\i",73),i("\\j",74),i("\\k",75),i("\\l",76),i("\\m",77),i("\\n",78),i("\\o",79),i("\\p",80),i("\\q",81),i("\\r",82),i("\\s",83),i("\\t",84),i("\\u",85),i("\\v",86),i("\\w",87),i("\\x",88),i("\\y",89),i("\\z",90),i("\\lwin",91),i("\\rwin",92),i("\\#0",96),i("\\#1",97),i("\\#2",98),i("\\#3",99),i("\\#4",100),i("\\#5",101),i("\\#6",102),i("\\#7",103),i("\\#8",104),i("\\#9",105),i("\\multiply",106),i("\\add",107),i("\\subtract",109),i("\\decimal",110),i("\\divide",111),i("\\f1",112),i("\\f2",113),i("\\f3",114),i("\\f4",115),i("\\f5",116),i("\\f6",117),i("\\f7",118),i("\\f8",119),i("\\f9",120),i("\\f10",121),i("\\f11",122),i("\\f12",123),i("\\numlock",144),i("\\scrolllock",145),i("\\semicolon",186),i("\\equals",187),i("\\comma",188),i("\\dash",189),i("\\fullstop",190),i("\\forwardslash",191),i("\\singlequote",192),i("\\openbracket",219),i("\\backslash",220),i("\\closebracket",221),i("\\hash",222),i("\\backtick",223)]},function(e,t,a){"use strict";a.d(t,"b",function(){return l}),a.d(t,"a",function(){return c}),a.d(t,"c",function(){return d});var n=a(0);const r=e=>({names:{BASIC:e.names[0],Pascal:e.names[1],Python:e.names[2]},code:e.code,parameters:e.parameters||[],returns:e.returns,type:e.returns?"function":"procedure",category:e.category,level:e.level,description:e.description}),o=(e,t,a=!1,n=1)=>({name:e,type:t,byref:a,length:n}),s=(e,t,a)=>({index:e,title:t,expressions:a}),i=(e,t)=>({names:{BASIC:e[0],Pascal:e[1],Python:e[2]},level:t}),l=[r({names:["FORWARD","forward","forward"],code:n.a.fwrd,parameters:[o("n","integer")],category:0,level:0,description:"Moves the Turtle forward <code>n</code> units, drawing as it goes (unless the pen is up)."}),r({names:["BACK","back","back"],code:n.a.back,parameters:[o("n","integer")],category:0,level:0,description:"Moves the Turtle back <code>n</code> units, drawing as it goes (unless the pen is up)."}),r({names:["LEFT","left","left"],code:n.a.left,parameters:[o("n","integer")],category:0,level:0,description:"Rotates the Turtle left by <code>n</code> degrees."}),r({names:["RIGHT","right","right"],code:n.a.rght,parameters:[o("n","integer")],category:0,level:0,description:"Rotates the Turtle right by <code>n</code> degrees."}),r({names:["DRAWXY","drawxy","drawxy"],code:n.a.drxy,parameters:[o("x","integer"),o("y","integer")],category:0,level:1,description:"Moves the Turtle in a straight line to a point <code>x</code> units away along the x-axis and <code>y</code> units away along the y-axis, drawing as it goes (unless the pen is up)."}),r({names:["MOVEXY","movexy","movexy"],code:n.a.mvxy,parameters:[o("x","integer"),o("y","integer")],category:0,level:1,description:"Moves the Turtle in a straight line to a point <code>x</code> units away along the x-axis and <code>y</code> units away along the y-axis, <em>without</em> drawing (regardless of the current pen status)."}),r({names:["HOME","home","home"],code:n.a.home,category:1,level:0,description:"Moves the Turtle back to its starting position in the centre of the canvas, facing north, drawing as it goes (unless the pen is up)."}),r({names:["SETX","setx","setx"],code:n.a.setx,parameters:[o("x","integer")],category:1,level:0,description:"Sets the Turtle&rsquo;s <code>x</code> coordinate directly (without movement or drawing on the canvas). This can also be achieved by direct assignment of the global variable <code>turtx</code>."}),r({names:["SETY","sety","sety"],code:n.a.sety,parameters:[o("y","integer")],category:1,level:0,description:"Sets the Turtle&rsquo;s <code>y</code> coordinate directly (without movement or drawing on the canvas). This can also be achieved by direct assignment of the global variable <code>turty</code>."}),r({names:["SETXY","setxy","setxy"],code:n.a.toxy,parameters:[o("x","integer"),o("y","integer")],category:1,level:0,description:"Sets the Turtle&rsquo;s <code>x</code> and <code>y</code> coordinates directly (without movement or drawing on the canvas). This can also be achieved by direct assingment of the global variables <code>turtx</code> and <code>turty</code>."}),r({names:["DIRECTION","direction","direction"],code:n.a.setd,parameters:[o("n","integer")],category:1,level:0,description:"Sets the Turtle&rsquo;s direction to <code>n</code> degrees (0 for north, 90 for east, 180 for south, 270 for west). This can also be achieved by direct assignment of the global variable <code>turtd</code>. Note that the number of degrees in a circle (360 by default) can be changed with the <code>angles</code> command."}),r({names:["TURNXY","turnxy","turnxy"],code:n.a.turn,parameters:[o("x","integer"),o("y","integer")],category:1,level:1,description:"Turns the Turtle to face the point <code>x</code> units away alongthe x-axis and <code>y</code> units away along the y-axis."}),r({names:["CIRCLE","circle","circle"],code:n.a.circ,parameters:[o("radius","integer")],category:2,level:0,description:"Draws a circle outline in the Turtle&rsquo;s current colour and thickness, of the given <code>radius</code>, centred on the Turtle&rsquo;s current location."}),r({names:["BLOT","blot","blot"],code:n.a.blot,parameters:[o("radius","integer")],category:2,level:0,description:"Draws a filled circle in the Turtle&rsquo;s current colour, of the given <code>radius</code>, centred on the Turtle&rsquo;s current location."}),r({names:["ELLIPSE","ellipse","ellipse"],code:n.a.elps,parameters:[o("Xradius","integer"),o("Yradius","integer")],category:2,level:0,description:"Draws an ellipse outline in the Turtle&rsquo;s current colour and thickness, of the given <code>Xradius</code> and <code>Yradius</code>, centred on the Turtle&rsquo;s current location."}),r({names:["ELLBLOT","ellblot","ellblot"],code:n.a.eblt,parameters:[o("Xradius","integer"),o("Yradius","integer")],category:2,level:0,description:"Draws a filled ellipse in the Turtle&rsquo;s current colour, of the given <code>Xradius</code> and <code>Yradius</code>, centred on the Turtle&rsquo;s current location."}),r({names:["POLYLINE","polyline","polyline"],code:n.a.poly,parameters:[o("n","integer")],category:2,level:1,description:"Draws a polygon outline in the Turtle&rsquo;s current colour and thickness, connecting the last <code>n</code> locations that the Turtle has visited."}),r({names:["POLYGON","polygon","polygon"],code:n.a.pfil,parameters:[o("n","integer")],category:2,level:1,description:"Draws a filled polygon in the Turtle&rsquo;s current colour and thickness, connecting the last <code>n</code> locations that the Turtle has visited."}),r({names:["FORGET","forget","forget"],code:n.a.frgt,parameters:[o("n","integer")],category:2,level:1,description:"Makes the Turtle &ldquo;forget&rdquo; the last <code>n</code> points it has visited. Used in conjunction with <code>polyline</code> and <code>polygon</code>."}),r({names:["REMEMBER","remember","remember"],code:n.a.rmbr,category:2,level:1,description:"Makes the Turtle &ldquo;remember&rdquo; its current location. This is only necessary if its current location was set by a direct assignment of the global variables <code>turtx</code> and <code>turty</code>; when using the standard moving commands, the Turtle automatically remembers where it has been."}),r({names:["BOX","box","box"],code:n.a.box,parameters:[o("x","integer"),o("y","integer"),o("colour","integer"),o("border","boolean")],category:2,level:1,description:"Draws a box of width <code>x</code> and height <code>y</code>, with the top left corner in the Turtle&rsquo;s current location, filled with the specified <code>colour</code>. If <code>border</code> is <code>true</code>, a border is drawn around the box in the Turtle&rsquo;s current colour and and thickness. This is intended to be used with the <code>print</code> command, to provide a box for framing text."}),r({names:["COLOUR","colour","colour"],code:n.a.colr,parameters:[o("colour","integer")],category:3,level:0,description:"Sets the <code>colour</code> of the Turtle&rsquo;s pen. Takes as an argument either an RGB value, or one of the Turtle System&rsquo;s fifty predefined colour constants (see the <b>Colours</b> tab). This can also be achieved by direct assignment of the global variable <code>turtc</code>."}),r({names:["RNDCOL","randcol","randcol"],code:n.a.rndc,parameters:[o("n","integer")],category:3,level:0,description:"Assigns a random colour to the Turte&rsquo;s pen, between 1 and <code>n</code> (maximum 50). The colours are taken from the Turtle System&rsquo;s fifty predefined colours, which are each assigned a number between 1 and 50 (see the <b>Colours</b> tab)."}),r({names:["THICKNESS","thickness","thickness"],code:n.a.thik,parameters:[o("thickness","integer")],category:3,level:0,description:"Sets the <code>thickness</code> of the Turtle&rsquo;s pen (for line drawing, and outlines of circles, ellipses, boxes, and polygons). This can also be achieved by direct assignment of the global variable <code>turtt</code>."}),r({names:["PENUP","penup","penup"],code:n.a.pnup,category:3,level:0,description:"Lifts the Turtle&rsquo;s pen, so that subsequent movement will not draw a line on the Canvas."}),r({names:["PENDOWN","pendown","pendown"],code:n.a.pndn,category:3,level:0,description:"Lowers the Turtle&rsquo;s pen, so that subsequent movement will draw a line on the Canvas."}),r({names:["OUTPUT","output","output"],code:n.a.outp,parameters:[o("clear","boolean"),o("colour","integer"),o("tofront","boolean")],category:3,level:1,description:"Modifies the textual output. If the first argument is <code>true</code>, it clears any existing text. The second argument specifies the background colour, and the third argument is for switching the display. If the third argument is <code>true</code>, it switches to the <b>Output</b> tab, while if it is <code>false</code>, it switches to the <b>Canvas and Console</b> tab."}),r({names:["CONSOLE","console","console"],code:n.a.cons,parameters:[o("clear","boolean"),o("colour","integer")],category:3,level:1,description:"Modifies the Console; if the first argument is <code>true</code>, it clears any existing text, while the second argument specifies the background colour."}),r({names:["RGB","rgb","rgb"],code:n.a.rgb,parameters:[o("colour","integer")],returns:"integer",category:3,level:2,description:"Returns the RGB value of the input <code>colour</code> (an integer between 1 and 50). For example, <code>rgb(red)=255</code>."}),r({names:["MIXCOLS","mixcols","mixcols"],code:n.a.mixc,parameters:[o("colour1","integer"),o("colour1","integer"),o("proportion1","integer"),o("proportion2","integer")],returns:"integer",category:3,level:2,description:"Mixes the given colours in the given proportions."}),r({names:["NEWTURTLE","newturtle","newturtle"],code:n.a.newt,parameters:[o("array","integer",!0,5)],category:3,level:2,description:"Points the Turtle to a custom array in memory (this must be an array of five integers, corresponding to the Turtle&rsquo;s five properties, <code>turtx</code>, <code>turty</code>, <code>turtd</code>, <code>turtt</code>, and <code>turtc</code>). Use repeatedly to simulate multiple Turtles."}),r({names:["OLDTURTLE","oldturtle","oldturtle"],code:n.a.oldt,category:3,level:2,description:"Points the Turtle back to the default (built-in) array in memory. Use in conjunction with <code>newturtle</code>."}),r({names:["UPDATE","update","update"],code:n.a.udat,category:4,level:0,description:"Makes the Machine update the Canvas, and continue updating with all subsequent drawing commands. Used in conjunction with <em>noupdate</em>."}),r({names:["NOUPDATE","noupdate","noupdate"],code:n.a.ndat,category:4,level:0,description:"Makes the Machine refrain from updating the Canvas when executing all subsequent drawing commands, until <em>update</em> is called. Use this to create smooth animations, by queueing up several drawing commands to execute simultaneously."}),r({names:["BLANK","blank","blank"],code:n.a.blnk,parameters:[o("colour","integer")],category:4,level:0,description:"Blanks the entire Canvas with the specified <code>colour</code>."}),r({names:["CANVAS","canvas","canvas"],code:n.a.canv,parameters:[o("x1","integer"),o("y1","integer"),o("x2","integer"),o("y2","integer")],category:4,level:1,description:"Sets the top left Canvas coordinate to <code>(x1,y1)</code>, and the Canvas width and height to <code>x2</code> and <code>y2</code> respectively. Note that the width and height fix the number of virtual points on the Canvas, not the number of actual pixels."}),r({names:["RESOLUTION","resolution","resolution"],code:n.a.reso,parameters:[o("x","integer"),o("y","integer")],category:4,level:1,description:"Sets the Canvas resolution, i.e. the number of actual pixels in the <code>x</code> and <code>y</code> dimensions. To be used in conjunction with the <code>canvas</code> command, typically to set the number of actual pixels equal to the number of virtual points on the Canvas."}),r({names:["ANGLES","angles","angles"],code:n.a.angl,parameters:[o("degrees","integer")],category:4,level:1,description:"Sets the number of <code>degrees</code> in a circle (360 by default)."}),r({names:["PIXSET","pixset","pixset"],code:n.a.pixs,parameters:[o("x","integer"),o("y","integer"),o("colour","integer")],category:4,level:2,description:"Sets the <code>colour</code> at point <code>(x,y)</code>."}),r({names:["PIXCOL","pixcol","pixcol"],code:n.a.pixc,parameters:[o("x","integer"),o("y","integer")],returns:"integer",category:4,level:2,description:"Returns the RGB value of the colour at point <code>(x,y)</code>."}),r({names:["RECOLOUR","recolour","recolour"],code:n.a.rcol,parameters:[o("x","integer"),o("y","integer"),o("colour","integer")],category:4,level:2,description:"Floods the Canvas with the specified <code>colour</code>, starting at point <code>(x,y)</code>, until reaching any different colour."}),r({names:["FILL","fill","fill"],code:n.a.fill,parameters:[o("x","integer"),o("y","integer"),o("colour","integer"),o("boundary","integer")],category:4,level:2,description:"Floods the Canvas with the specified <code>colour</code>, starting at point <code>(x,y)</code>, until reaching the <code>boundary</code> colour."}),r({names:["INC","inc","inc"],code:n.a.incr,parameters:[o("variable","integer",!0)],category:5,level:0,description:"Increments the specified <code>variable</code> by 1."}),r({names:["DEC","dec","dec"],code:n.a.decr,parameters:[o("variable","integer",!0)],category:5,level:0,description:"Decrements the specified <code>variable</code> by 1."}),r({names:["ABS","abs","abs"],code:n.a.abs,parameters:[o("n","integer")],returns:"integer",category:5,level:0,description:"Returns the absolute value of <code>n</code>, i.e. <code>n</code> if positive, <code>-n</code> if negative."}),r({names:["SIGN","sign","sign"],code:n.a.sign,parameters:[o("a","integer")],returns:"integer",category:5,level:1,description:"Returns <code>+1</code> if <code>a</code> is positive, <code>-1</code> if <code>a</code> is negative, and <code>0</code> otherwise."}),r({names:["MAX","max","max"],code:n.a.maxi,parameters:[o("a","integer"),o("b","integer")],returns:"integer",category:5,level:1,description:"Returns the maximum of <code>a</code> and <code>b</code>."}),r({names:["MIN","min","min"],code:n.a.mini,parameters:[o("a","integer"),o("b","integer")],returns:"integer",category:5,level:1,description:"Returns the minimum of <code>a</code> and <code>b</code>."}),r({names:["SQR","sqrt","sqrt"],code:n.a.sqrt,parameters:[o("a","integer"),o("mult","integer")],returns:"integer",category:5,level:1,description:"Returns <code>&radic;a</code>, multiplied by <code>mult</code> and rounded to the nearest integer. Use the multiplier to approximate real numbers."}),r({names:["HYPOT","hypot","hypot"],code:n.a.hyp,parameters:[o("a","integer"),o("b","integer"),o("mult","integer")],returns:"integer",category:5,level:1,description:"Returns <code>&radic;(a<sup>2</sup>+b<sup>2</sup>)</code>, multiplied by <code>mult</code> and rounded to the nearest integer. Use the multiplier to approximate real numbers."}),r({names:["RND",null,null],code:n.a.rand,parameters:[o("n","integer")],returns:"integer",category:5,level:1,description:"Returns a random integer between 1 and <code>n</code>."}),r({names:[null,"random",null],code:n.a.rand,parameters:[o("n","integer")],returns:"integer",category:5,level:1,description:"Returns a random non-negative integer less than <code>n</code>."}),r({names:[null,null,"randint"],code:n.a.rand,parameters:[o("a","integer"),o("b","integer")],returns:"integer",category:5,level:1,description:"Returns a random integer between <code>a</code> and <code>b</code>."}),r({names:["POWER","power","power"],code:n.a.powr,parameters:[o("a","integer"),o("b","integer"),o("c","integer"),o("mult","integer")],returns:"integer",category:5,level:2,description:"Returns <code>(a/b)<sup>c</sup></code>, multiplied by <code>mult</code> and rounded to the nearest integer. Use the multiplier to approximate real numbers."}),r({names:["ROOT","root","root"],code:n.a.root,parameters:[o("a","integer"),o("b","integer"),o("c","integer"),o("mult","integer")],returns:"integer",category:5,level:2,description:"Returns <code><sup>c</sup>&radic;(a/b)</code>, multiplied by <code>mult</code> and rounded to the nearest integer. Use the multiplier to approximate real numbers."}),r({names:["DIVMULT","divmult","divmult"],code:n.a.divm,parameters:[o("a","integer"),o("b","integer"),o("mult","integer")],returns:"integer",category:5,level:2,description:"Returns <code>a/b</code>, multiplied by <code>mult</code> and rounded to the nearest integer. Use the multiplier to approximate real numbers."}),r({names:["MAXINT","maxint","maxint"],code:n.a.mxin,returns:"integer",category:5,level:2,description:"Returns the maximum integer that the Machine can deal with (2<sup>31</sup>-1)."}),r({names:["SIN","sin","sin"],code:n.a.sin,parameters:[o("a","integer"),o("b","integer"),o("mult","integer")],returns:"integer",category:6,level:1,description:"Returns <code>sin(a/b)</code>, multiplied by <code>mult</code> and rounded to the nearest integer. Use the multiplier to approximate real numbers."}),r({names:["COS","cos","cos"],code:n.a.cos,parameters:[o("a","integer"),o("b","integer"),o("mult","integer")],returns:"integer",category:6,level:1,description:"Returns <code>cos(a/b)</code>, multiplied by <code>mult</code> and rounded to the nearest integer. Use the multiplier to approximate real numbers."}),r({names:["TAN","tan","tan"],code:n.a.tan,parameters:[o("a","integer"),o("b","integer"),o("mult","integer")],returns:"integer",category:6,level:1,description:"Returns <code>tan(a/b)</code>, multiplied by <code>mult</code> and rounded to the nearest integer. Use the multiplier to approximate real numbers."}),r({names:["PI","pi","pi"],code:n.a.pi,parameters:[o("mult","integer")],returns:"integer",category:6,level:1,description:"Returns the value of Pi, multiplied by <code>mult</code> and rounded to the nearest integer. Use the multiplier to approximate real numbers."}),r({names:["EXP","exp","exp"],code:n.a.exp,parameters:[o("a","integer"),o("b","integer"),o("mult","integer")],returns:"integer",category:6,level:1,description:"Returns <code>a<sup>b</sup></code>, multiplied by <code>mult</code> and rounded to the nearest integer. Use the multiplier to approximate real numbers."}),r({names:["LN","ln","ln"],code:n.a.ln,parameters:[o("a","integer"),o("b","integer"),o("mult","integer")],returns:"integer",category:6,level:1,description:"Returns <code>ln(a/b)</code>, multiplied by <code>mult</code> and rounded to the nearest integer. Use the multiplier to approximate real numbers."}),r({names:["ANTILOG","antilog","antilog"],code:n.a.alog,parameters:[o("a","integer"),o("b","integer"),o("mult","integer")],returns:"integer",category:6,level:2,description:"Returns <code>antilog<sub>10</sub>(a/b)</code> - i.e. <code>10<sup>a/b</sub></code> - multiplied by <code>mult</code> and rounded to the nearest integer. Use the multiplier to approximate real numbers."}),r({names:["LOG10","log10","log10"],code:n.a.log,parameters:[o("a","integer"),o("b","integer"),o("mult","integer")],returns:"integer",category:6,level:2,description:"Returns <code>log<sub>10</sub>(a/b)</code>, multiplied by <code>mult</code> and rounded to the nearest integer. Use the multiplier to approximate real numbers."}),r({names:["ASN","arcsin","asin"],code:n.a.asin,parameters:[o("a","integer"),o("b","integer"),o("mult","integer")],returns:"integer",category:6,level:2,description:"Returns <code>arcsin(a/b)</code>, multiplied by <code>mult</code> and rounded to the nearest integer. Use the multiplier to approximate real numbers."}),r({names:["ACS","arccos","acos"],code:n.a.acos,parameters:[o("a","integer"),o("b","integer"),o("mult","integer")],returns:"integer",category:6,level:2,description:"Returns <code>arccos(a/b)</code>, multiplied by <code>mult</code> and rounded to the nearest integer. Use the multiplier to approximate real numbers."}),r({names:["ATN","arctan","atan"],code:n.a.atan,parameters:[o("a","integer"),o("b","integer"),o("mult","integer")],returns:"integer",category:6,level:2,description:"Returns <code>arctan(a/b)</code>, multiplied by <code>mult</code> and rounded to the nearest integer. Use the multiplier to approximate real numbers."}),r({names:["WRITE","write","write"],code:n.a.text,parameters:[o("string","string")],category:7,level:0,description:"Writes the input <code>string</code> to the console and textual output area of the System."}),r({names:["WRITELN","writeln","writeline"],code:n.a.texl,parameters:[o("string","string")],category:7,level:0,description:"Writes the input <code>string</code> to the console and textual output area of the System, followed by a line break."}),r({names:["PRINT","print","print"],code:n.a.prnt,parameters:[o("string","string"),o("font","integer"),o("size","integer")],category:7,level:0,description:"Prints the input <code>string</code> in the Turtle&rsquo;s current colour and at the Turtle&rsquo;s current location, in the specified <code>font</code> and <code>size</code>. Can be used in conjunction with the <code>box</code> drawing command. For a list of available fonts, see the <b>Constants</b> tab."}),r({names:["UCASE$","uppercase","upper"],code:n.a.uppc,parameters:[o("string","string")],returns:"string",category:7,level:1,description:"Returns the input <code>string</code> as all uppercase."}),r({names:["LCASE$","lowercase","lower"],code:n.a.lowc,parameters:[o("string","string")],returns:"string",category:7,level:1,description:"Returns the input <code>string</code> as all lowercase."}),r({names:["LEN","length","len"],code:n.a.slen,parameters:[o("string","string")],returns:"integer",category:7,level:1,description:"Returns the length of the input <code>string</code> (i.e. the number of characters)."}),r({names:["DEL$","delete",null],code:n.a.dels,parameters:[o("string","string"),o("index","integer"),o("length","integer")],returns:"string",category:7,level:2,description:"Returns the input <code>string</code> with some characters removed, starting at the given <code>index</code> and of the specified <code>length</code>."}),r({names:["LEFT$",null,null],code:n.a.lefs,parameters:[o("string","string"),o("length","integer")],returns:"string",category:7,level:2,description:"Returns a copy of the characters in the input <code>string</code>, starting on the left and of the specified <code>length</code>."}),r({names:["MID$","copy","copy"],code:n.a.copy,parameters:[o("string","string"),o("index","integer"),o("length","integer")],returns:"string",category:7,level:2,description:"Returns a copy of the characters in the input <code>string</code>, starting at the given <code>index</code> and of the specified <code>length</code>."}),r({names:["RIGHT$",null,null],code:n.a.rgts,parameters:[o("string","string"),o("length","integer")],returns:"string",category:7,level:2,description:"Returns a copy of the characters in the input <code>string</code>, starting on the right and of the specified <code>length</code>."}),r({names:["INS$",null,"insert"],code:n.a.inss,parameters:[o("string","string"),o("index","integer"),o("substr","string")],returns:"string",category:7,level:2,description:"Returns the input <code>string</code> with the specified <code>substring</code> inserted at the given <code>index</code>."}),r({names:[null,"insert",null],code:n.a.inss,parameters:[o("substr","string"),o("string","string"),o("index","integer")],returns:"string",category:7,level:2,description:"Returns the input <code>string</code> with the specified <code>substring</code> inserted at the given <code>index</code>."}),r({names:["REPLACE","replace","replace"],code:n.a.repl,parameters:[o("string","string"),o("substr","string"),o("replace","string"),o("n","integer")],returns:"string",category:7,level:2,description:"Returns the input <code>string</code> with up to <code>n</code> occurences of <code>substring</code> replaced by <code>replace</code>. Set <code>n</code> equal to <code>0</code> to replace every occurence."}),r({names:["INSTR",null,"find"],code:n.a.poss,parameters:[o("string","string"),o("substr","string")],returns:"integer",category:7,level:2,description:"Searches for the input <code>substring</code> within the given <code>string</code>; returns the index of the first character if found, 0 otherwise."}),r({names:[null,"pos",null],code:n.a.poss,parameters:[o("substr","string"),o("string","string")],returns:"integer",category:7,level:2,description:"Searches for the input <code>substring</code> within the given <code>string</code>; returns the index of the first character if found, 0 otherwise."}),r({names:["STR$","str","str"],code:n.a.itos,parameters:[o("n","integer")],returns:"string",category:8,level:0,description:"Returns the integer <code>n</code> as a string, e.g. <code>str(12)='12'</code>."}),r({names:["VAL","val","integer"],code:n.a.svd0,parameters:[o("string","string")],returns:"integer",category:8,level:0,description:"Returns the input <code>string</code> as an integer, e.g. <code>val('12')=12</code>. Returns <code>0</code> if the string cannot be converted (i.e. if it is not an integer string)."}),r({names:["VALDEF","valdef","intdef"],code:n.a.sval,parameters:[o("string","string"),o("default","string")],returns:"integer",category:8,level:0,description:"Returns the input <code>string</code> as an integer, e.g. <code>val('12')=12</code>. Returns the specified <code>default</code> value if the string cannot be converted (i.e. if it is not an integer string)."}),r({names:["QSTR$","qstr","qstr"],code:n.a.qtos,parameters:[o("a","integer"),o("b","integer"),o("decplaces","integer")],returns:"string",category:8,level:1,description:"Returns the value of <code>a/b</code> to the specified number of decimal places, as a decimal string, e.g. <code>qstr(2,3,4)='0.6667'</code>."}),r({names:["QVAL","qval","qval"],code:n.a.qval,parameters:[o("string","string"),o("mult","integer"),o("default","integer")],returns:"integer",category:8,level:1,description:"Returns the input decimal <code>string</code> as an integer, multiplied by <code>mult</code> and rounded to the nearest integer, e.g. <code>qval('1.5',10)=15</code>. Returns the specified <code>default</code> value if the string cannot be converted (i.e. if it is not a decimal string)."}),r({names:["CHR$","chr","chr"],code:n.a.null,parameters:[o("n","integer")],returns:"char",category:8,level:2,description:"Returns the character with ASCII character code <code>n</code>, e.g. <code>chr(65)='A'</code>."}),r({names:["ASC","ord","ord"],code:n.a.null,parameters:[o("char","char")],returns:"integer",category:8,level:2,description:"Returns the ASCII code of the input character <code>char</code> (which must be a string of length 1), e.g. <code>ord('A')=65</code>."}),r({names:["BOOLINT","boolint",null],code:n.a.null,parameters:[o("boolean","boolean")],returns:"integer",category:8,level:2,description:"Returns the input <code>boolean</code> as an integer (-1 for <code>true</code>, 0 for <code>false</code>)."}),r({names:[null,null,"boolint"],code:n.a.bool,parameters:[o("boolean","boolean")],returns:"integer",category:8,level:2,description:"Returns the input <code>boolean</code> as an integer (1 for <code>true</code>, 0 for <code>false</code>)."}),r({names:["HEX$","hexstr","hex"],code:n.a.hexs,parameters:[o("n","integer"),o("minlength","integer")],category:8,level:2,description:"Returns a string representation of integer <code>n</code> in hexadecimal format, padded with leading zeros as up to <code>minlength</code>, e.g. <code>hexstr(255,6)='0000FF'</code>."}),r({names:["PAUSE","pause","pause"],code:n.a.wait,parameters:[o("m","integer")],category:9,level:0,description:"Makes the Turtle Machine wait <code>m</code> milliseconds before performing the next operation. This is useful for controlling the speed of animations."}),r({names:["GETLINE$","readln","readline"],code:n.a.rdln,returns:"string",category:9,level:0,description:"Waits for the RETURN key to be pressed, then returns everything in the keybuffer up to (and not including) the new line character."}),r({names:["INPUT$",null,"input"],code:n.a.ilin,parameters:[o("prompt","string")],returns:"string",category:9,level:0,description:"Gives an input prompt, then returns the input when the RETURN key is pressed (using the keybuffer)."}),r({names:["CURSOR","cursor","cursor"],code:n.a.curs,parameters:[o("cursorcode","integer")],category:9,level:1,description:"Sets which cursor to display (1-15) when the mouse pointer is over the canvas. 0 hides the cursor; any value outside the range 0-15 resets the default cursor. For a list of available cursors, see the <b>Cursors</b> tab."}),r({names:["KEYECHO","keyecho","keyecho"],code:n.a.kech,parameters:[o("on","boolean")],category:9,level:1,description:"Turns the keyboard echo to the console on (<code>true</code>) or off (<code>false</code>)."}),r({names:["DETECT","detect","detect"],code:n.a.tdet,parameters:[o("keycode","integer"),o("m","integer")],returns:"boolean",category:9,level:1,description:"Waits a maximum of <code>m</code> milliseconds for the key with the specified <code>keycode</code> to be pressed; returns <code>true</code> if pressed (and stops waiting), <code>false</code> otherwise."}),r({names:["GET$","read","read"],code:n.a.read,parameters:[o("n","integer")],returns:"string",category:9,level:1,description:"Returns the first <code>n</code> characters from the keybuffer as a string."}),r({names:["TIME","time","time"],code:n.a.time,returns:"integer",category:9,level:1,description:"Returns the time (in milliseconds) since the program began."}),r({names:["TIMESET","timeset","timeset"],code:n.a.tset,parameters:[o("m","integer")],category:9,level:1,description:"Artificially sets the time since the program began to <code>m</code> milliseconds."}),r({names:["RESET","reset","reset"],code:n.a.iclr,parameters:[o("?input","integer")],category:9,level:2,description:"Resets the specified <code>?input</code> (<code>?mousex</code>, <code>?mousey</code>, <code>?click</code>, etc.) to its initial value (i.e. -1)."}),r({names:["KEYSTATUS","keystatus","keystatus"],code:n.a.inpt,parameters:[o("keycode","integer")],returns:"integer",category:9,level:2,description:"Returns the <code>?kshift</code> value for the most recent press of the key with the specified <code>keycode</code>."}),r({names:["KEYBUFFER","keybuffer","keybuffer"],code:n.a.bufr,parameters:[o("n","integer")],category:9,level:2,description:"Creates a new custom keybuffer of length <code>n</code>. A keybuffer of length 32 is available by default; use this command if you need a larger buffer."}),r({names:["HALT","halt","halt"],code:n.a.halt,category:10,level:0,description:"Halts the program."}),r({names:["TRACE","trace","trace"],code:n.a.trac,parameters:[o("on","boolean")],category:10,level:2,description:"Turns the PCode trace facility on (<code>true</code>) or off (<code>false</code>)."}),r({names:["WATCH","watch","watch"],code:n.a.memw,parameters:[o("address","integer")],category:10,level:2,description:"Sets an <code>address</code> in memory for the trace facility to watch."}),r({names:["DUMP","dump","dump"],code:n.a.dump,category:10,level:2,description:"&ldquo;Dumps&rdquo; the current memory state into the display in the memory tab."}),r({names:["HEAPRESET","heapreset","heapreset"],code:n.a.hrst,category:10,level:2,description:"Resets the memory heap to the initial global value."})],c=[s(0,"Turtle: relative movement",l.filter(e=>0===e.category)),s(1,"Turtle: absolute movement",l.filter(e=>1===e.category)),s(2,"Turtle: drawing shapes",l.filter(e=>2===e.category)),s(3,"Other Turtle commands",l.filter(e=>3===e.category)),s(4,"Canvas operations",l.filter(e=>4===e.category)),s(5,"General arithmetic functions",l.filter(e=>5===e.category)),s(6,"Trig / exp / log functions",l.filter(e=>6===e.category)),s(7,"String operations",l.filter(e=>7===e.category)),s(8,"Type conversion routines",l.filter(e=>8===e.category)),s(9,"Input and timing routines",l.filter(e=>9===e.category)),s(10,"Turtle Machine monitoring",l.filter(e=>10===e.category))],d=c.concat({title:"Command structures",expressions:[i(["IF","if","if"],0),i(["ELSE","else","else"],0),i(["FOR","for","for"],0),i(["REPEAT","repeat","repeat"],1),i(["WHILE","while","while"],1),i(["DEF",null,"def"],1),i([null,"procedure",null],1),i([null,"function",null],2)]},{title:"Variable scope modifiers",expressions:[i(["LOCAL",null,null],1),i(["PRIVATE",null,null],2),i([null,null,"global"],1),i([null,null,"nonlocal"],2)]})},function(e,t,a){"use strict";var n=e=>{let t=[];for(;e.length>0;){let a=r(e)||o(e)||s(e)||c(e)||i(e)||l(e)||d(e)||u(e)||p(e)||m(e)||h(e)||g(e)||w(e)||b(e)||f(e)||v(e)||y(e)||x(e)||k(e);t.push(a),e=e.slice(a.content.length)}return t};const r=e=>{return!!("\n"===e[0])&&{type:"linebreak",content:"\n"}},o=e=>{const t=e.match(/^( +)/);return!!t&&{type:"spaces",content:t[0]}},s=e=>{return!!e.match(/^REM\b/)&&{type:"comment",content:e.split("\n")[0]}},i=e=>{const t=e.match(/^(\+|-|\*|\/|DIV\b|MOD\b|=|<>|<=|>=|<|>|NOT\b|AND\b|OR\b|EOR\b)/);return!!t&&{type:"operator",content:t[0]}},l=e=>{const t=e.match(/^(\(|\)|,|:)/);return!!t&&{type:"punctuation",content:t[0]}},c=e=>{const t="'"===e[0],a='"'===e[0],n=e.match(/[^\\](')/),r=e.match(/[^\\](")/);return t&&n?{type:"string",content:e.slice(0,n.index+2)}:t?{type:"unterminated-string",content:e.split("\n")[0]}:a&&r?{type:"string",content:e.slice(0,r.index+2)}:!!a&&{type:"unterminated-string",content:e.split("\n")[0]}},d=e=>{const t=e.match(/^(TRUE|FALSE)\b/);return!!t&&{type:"boolean",content:t[0]}},u=e=>{const t=e.match(/^(%[01]+)\b/),a=e.match(/^(0b[01]+)\b/);return t?{type:"binary",content:t[0]}:!!a&&{type:"bad-binary",content:a[0]}},p=e=>{const t=e.match(/^((\$|#|(0x))[A-Fa-f0-9]+)\b/),a=e.match(/^(&[A-Fa-f0-9]+)\b/);return t?{type:"bad-hexadecimal",content:t[0]}:!!a&&{type:"hexadecimal",content:a[0]}},m=e=>{const t=e.match(/^(\d+\.\d+)/),a=e.match(/^(\d+)\b/);return t?{type:"bad-decimal",content:t[0]}:!!a&&{type:"decimal",content:a[0]}},h=e=>{const t=e.match(/^(DEF|DIM|ELSE|END|ENDIF|ENDPROC|ENDWHILE|FOR|IF|LOCAL|NEXT|PRIVATE|REPEAT|RETURN|STEP|THEN|TO|UNTIL|WHILE)\b/);return!!t&&{type:"keyword",content:t[0]}},g=e=>{const t=e.match(/^(ABS\b|ACS\b|ANGLES\b|ANTILOG\b|ASC\b|ASN\b|ATN\b|BACK\b|BLANK\b|BLOT\b|BOOLINT\b|BOX\b|CANVAS\b|CHR\$|CIRCLE\b|COLOU?R\b|CONSOLE\b|COS\b|CURSOR\b|DEC\b|DEL\$|DETECT\b|DIRECTION\b|DIVMULT\b|DRAWXY\b|DUMP\b|ELLBLOT\b|ELLIPSE\b|EXP\b|FILL\b|FORGET\b|FORWARD\b|GET\$|GETLINE\$|HEAPRESET|HEX\$|HOME\b|HYPOT\b|INC\b|INPUT\$|INSTR|KEYBUFFER\b|KEYECHO\b|KEYSTATUS\b|LCASE\$|LEFT\$|LEFT\b|LEN\b|LN\b|LOG10\b|MAX\b|MAXINT\b|MID\$|MIN\b|MIXCOLS\b|MOVEXY\b|NEWTURTLE\b|NOUPDATE\b|OLDTURTLE\b|OUTPUT\b|PAUSE\b|PENDOWN\b|PENUP\b|PI\b|PIXCOL\b|PIXSET\b|POLYGON\b|POLYLINE\b|POWER\b|PRINT\b|QSTR\$|QVAL\b|RECOLOUR\b|REMEMBER\b|RESET\b|RESOLUTION\b|RGB\b|RIGHT\$|RIGHT\b|RND\b|RNDCOL\b|ROOT\b|SETX\b|SETXY\b|SETY\b|SIGN\b|SIN\b|SQR\b|STR\$|TAN\b|THICKNESS\b|TIME\b|TIMESET\b|TRACE\b|TURNXY\b|UPDATE\b|UCASE\$|VAL\b|VALDEF\b|WATCH\b|WRITE\b|WRITELN\b)/);return!!t&&{type:"command",content:t[0]}},b=e=>{const t=e.match(/^(TURT[XYDTC]%)\b/);return!!t&&{type:"turtle",content:t[0]}},f=e=>{const t=e.match(/^(TRUE|FALSE|GREEN|DARKGREEN|LIGHTGREEN|SEAGREEN|GREENGREY|GREENGRAY|RED|DARKRED|LIGHTRED|MAROON|REDGREY|REDGRAY|BLUE|DARKBLUE|LIGHTBLUE|ROYAL|BLUEGREY|YELLOW|OCHRE|CREAM|GOLD|YELLOWGREY|YELLOWGRAY|VIOLET|INDIGO|LILAC|PURPLE|DARKGREY|DARKGRAY|LIME|OLIVE|YELLOWGREEN|EMERALD|MIDGREY|MIDGRAY|ORANGE|ORANGERED|PEACH|SALMON|LIGHTGREY|LIGHTGRAY|SKYBLUE|TEAL|CYAN|TURQUOISE|SILVER|BROWN|DARKBROWN|LIGHTBROWN|COFFEE|WHITE|PINK|MAGENTA|LIGHTPINK|ROSE|BLACK)\b/);return!!t&&{type:"colour",content:t[0]}},y=e=>{const t=e.match(/^(\\[#A-Z0-9]+)/);return!!t&&{type:"keycode",content:t[0]}},x=e=>{const t=e.match(/^(\?[A-Z]+)\b/);return!!t&&{type:"query",content:t[0]}},w=e=>{const t=e.match(/^((PROC|FN)[_a-zA-Z]+)\b/);return!!t&&{type:"custom",content:t[0]}},v=e=>{const t=e.match(/^([_a-zA-Z0-9]+[$|%])/);return!!t&&{type:"variable",content:t[0]}},k=e=>{const t=e.match(/^\d+/),a="#"===e[0];return t?{type:"unterminated-integer",content:e}:a?{type:"bad-hexadecimal",content:e}:{type:"illegal",content:e.split(/\b/)[0]}};var T=e=>{const t=[];for(;e.length>0;){let a=E(e)||S(e)||R(e)||O(e)||L(e)||P(e)||C(e)||I(e)||M(e)||A(e)||N(e)||D(e)||F(e)||B(e)||U(e)||G(e)||q(e)||H(e)||j(e)||$(e);t.push(a),e=e.slice(a.content.length)}return t};const E=e=>{return!!("\n"===e[0])&&{type:"linebreak",content:"\n"}},S=e=>{const t=e.match(/^( +)/);return!!t&&{type:"spaces",content:t[0]}},R=e=>{const t="{"===e[0],a=e.match(/}/);return t&&a?{type:"comment",content:e.slice(0,a.index+1)}:!!t&&{type:"unterminated-comment",content:e.split("\n")[0]}},O=e=>{const t=e.match(/^(\+|-|\*|\/|div\b|mod\b|=|<>|<=|>=|<|>|:=|not\b|and\b|or\b|xor\b)/i);return!!t&&{type:"operator",content:t[0]}},L=e=>{const t=e.match(/^(\(|\)|\[|\]|,|:|;|\.\.|\.)/);return!!t&&{type:"punctuation",content:t[0]}},P=e=>{const t="'"===e[0],a='"'===e[0],n=e.match(/[^\\](')/),r=e.match(/[^\\](")/);return t&&n?{type:"string",content:e.slice(0,n.index+2)}:t?{type:"unterminated-string",content:e.split("\n")[0]}:a&&r?{type:"string",content:e.slice(0,r.index+2)}:!!a&&{type:"unterminated-string",content:e.split("\n")[0]}},C=e=>{const t=e.match(/^(true|false)\b/i);return!!t&&{type:"boolean",content:t[0]}},I=e=>{const t=e.match(/^(%[01]+)\b/),a=e.match(/^(0b[01]+)\b/);return t?{type:"binary",content:t[0]}:!!a&&{type:"bad-binary",content:a[0]}},M=e=>{const t=e.match(/^(&[0-7]+)\b/),a=e.match(/^(0o[0-7]+)\b/);return t?{type:"octal",content:t[0]}:!!a&&{type:"bad-octal",content:a[0]}},A=e=>{const t=e.match(/^((&|#|(0x))[A-Fa-f0-9]+)\b/),a=e.match(/^(\$[A-Fa-f0-9]+)\b/);return t?{type:"bad-hexadecimal",content:t[0]}:!!a&&{type:"hexadecimal",content:a[0]}},N=e=>{const t=e.match(/^(\d+\.\d+)/),a=e.match(/^(\d+)\b/);return t?{type:"bad-decimal",content:t[0]}:!!a&&{type:"decimal",content:a[0]}},D=e=>{const t=e.match(/^(begin|const|do|downto|else|end|for|function|if|of|procedure|program|repeat|result|then|to|until|var|while)\b/i);return!!t&&{type:"keyword",content:t[0]}},F=e=>{const t=e.match(/^(array|boolean|char|integer|string)\b/i);return!!t&&{type:"type",content:t[0]}},B=e=>{const t=e.match(/^(abs|angles|antilog|arccos|arcsin|arctan|back|blank|blot|boolint|box|canvas|chr|circle|colou?r|console|copy|cos|cursor|dec|delete|detect|direction|divmult|drawxy|dump|ellblot|ellipse|exp|fill|forget|forward|heapreset|hexstr|home|hypot|inc|insert|keybuffer|keyecho|keystatus|left|length|ln|log10|lowercase|max|maxint|min|mixcols|movexy|newturtle|noupdate|oldturtle|ord|output|pause|pendown|penup|pi|pixcol|pixset|polygon|polyline|pos|power|print|qstr|qval|randcol|random|read|readln|recolour|remember|reset|resolution|rgb|right|root|setx|setxy|sety|sign|sin|sqrt|str|tan|thickness|time|timeset|trace|turnxy|update|uppercase|val|valdef|watch|write|writeln)\b/i);return!!t&&{type:"command",content:t[0]}},U=e=>{const t=e.match(/^(turt[xydtc])\b/i);return!!t&&{type:"turtle",content:t[0]}},G=e=>{const t=e.match(/^(true|false|green|darkgreen|lightgreen|seagreen|greengrey|greengray|red|darkred|lightred|maroon|redgrey|redgray|blue|darkblue|lightblue|royal|bluegrey|yellow|ochre|cream|gold|yellowgrey|yellowgray|violet|indigo|lilac|purple|darkgrey|darkgray|lime|olive|yellowgreen|emerald|midgrey|midgray|orange|orangered|peach|salmon|lightgrey|lightgray|skyblue|teal|cyan|turquoise|silver|brown|darkbrown|lightbrown|coffee|white|pink|magenta|lightpink|rose|black)\b/i);return!!t&&{type:"colour",content:t[0]}},q=e=>{const t=e.match(/^(\\[#a-z0-9]+)/i);return!!t&&{type:"keycode",content:t[0]}},H=e=>{const t=e.match(/^(\?[a-z]+)\b/i);return!!t&&{type:"query",content:t[0]}},j=e=>{const t=e.match(/^([_a-zA-Z][_a-zA-Z0-9]*)\b/);return!!t&&{type:"identifier",content:t[0]}},$=e=>({type:"illegal",content:e.split(/\b/)[0]});var W=e=>{let t=[];for(;e.length>0;){let a=z(e)||Y(e)||X(e)||V(e)||K(e)||Q(e)||_(e)||Z(e)||J(e)||ee(e)||te(e)||ae(e)||ne(e)||re(e)||oe(e)||se(e)||ie(e)||le(e)||ce(e);t.push(a),e=e.slice(a.content.length)}return t};const z=e=>{return!!("\n"===e[0])&&{type:"linebreak",content:"\n"}},Y=e=>{const t=e.match(/^( +)/);return!!t&&{type:"spaces",content:t[0]}},X=e=>{return!!e.match(/^#/)&&{type:"comment",content:e.split("\n")[0]}},V=e=>{const t=e.match(/^(\+|-|\*|\/\/|\/|%|==|!=|<=|>=|=|<|>|not\b|and\b|or\b|xor\b)/);return!!t&&{type:"operator",content:t[0]}},K=e=>{const t=e.match(/^(\(|\)|,|:)/);return!!t&&{type:"punctuation",content:t[0]}},Q=e=>{const t="'"===e[0],a='"'===e[0],n=e.match(/[^\\](')/),r=e.match(/[^\\](")/);return t&&n?{type:"string",content:e.slice(0,n.index+2)}:t?{type:"unterminated-string",content:e.split("\n")[0]}:a&&r?{type:"string",content:e.slice(0,r.index+2)}:!!a&&{type:"unterminated-string",content:e.split("\n")[0]}},_=e=>{const t=e.match(/^(True|False)\b/);return!!t&&{type:"boolean",content:t[0]}},Z=e=>{const t=e.match(/^(0b[01]+)\b/),a=e.match(/^(%[01]+)\b/);return t?{type:"binary",content:t[0]}:!!a&&{type:"bad-binary",content:a[0]}},J=e=>{const t=e.match(/^(0o[0-7]+)\b/),a=e.match(/^(&[0-7]+)\b/);return t?{type:"octal",content:t[0]}:!!a&&{type:"bad-octal",content:a[0]}},ee=e=>{const t=e.match(/^(0x[A-Fa-f0-9]+)\b/),a=e.match(/^((&|#|\$)[A-Fa-f0-9]+)\b/);return t?{type:"hexadecimal",content:t[0]}:!!a&&{type:"bad-hexadecimal",content:a[0]}},te=e=>{const t=e.match(/^(\d+\.\d+)/),a=e.match(/^(\d+)\b/);return t?{type:"bad-decimal",content:t[0]}:!!a&&{type:"decimal",content:a[0]}},ae=e=>{const t=e.match(/^(def|else|for|global|if|in|nonlocal|pass|range|return|while)\b/);return!!t&&{type:"keyword",content:t[0]}},ne=e=>{const t=e.match(/^(abs|acos|angles|antilog|asin|atan|back|blank|blot|boolint|box|canvas|chr|circle|colou?r|console|copy|cos|cursor|dec|detect|direction|divmult|drawxy|dump|ellblot|ellipse|exp|fill|find|forget|forward|heapreset|hex|home|hypot|inc|input|insert|int|intdef|keybuffer|keyecho|keystatus|left|len|ln|log10|lower|max|maxint|min|mixcols|movexy|newturtle|noupdate|oldturtle|ord|output|pause|pendown|penup|pi|pixcol|pixset|polygon|polyline|power|print|qstr|qval|randcol|randint|read|readline|recolour|remember|reset|resolution|rgb|right|root|setx|setxy|sety|sign|sin|sqrt|str|tan|thickness|time|timeset|trace|turnxy|update|upper|watch|write|writeline)\b/);return!!t&&{type:"command",content:t[0]}},re=e=>{const t=e.match(/^(turt[xydtc])\b/);return!!t&&{type:"turtle",content:t[0]}},oe=e=>{const t=e.match(/^(green|darkgreen|lightgreen|seagreen|greengrey|greengray|red|darkred|lightred|maroon|redgrey|redgray|blue|darkblue|lightblue|royal|bluegrey|yellow|ochre|cream|gold|yellowgrey|yellowgray|violet|indigo|lilac|purple|darkgrey|darkgray|lime|olive|yellowgreen|emerald|midgrey|midgray|orange|orangered|peach|salmon|lightgrey|lightgray|skyblue|teal|cyan|turquoise|silver|brown|darkbrown|lightbrown|coffee|white|pink|magenta|lightpink|rose|black)\b/);return!!t&&{type:"colour",content:t[0]}},se=e=>{const t=e.match(/^(\\[#a-z0-9]+)/i);return!!t&&{type:"keycode",content:t[0]}},ie=e=>{const t=e.match(/^(\?[a-z]+)\b/);return!!t&&{type:"query",content:t[0]}},le=e=>{const t=e.match(/^([_a-zA-Z][_a-zA-Z0-9]*)\b/);return!!t&&{type:"identifier",content:t[0]}},ce=e=>({type:"illegal",content:e.split(/\b/)[0]});t.a=((e,t)=>{return{BASIC:n,Pascal:T,Python:W}[t](e)})},function(e,t){const a=(e,t,a)=>({index:e,title:t,examples:a});e.exports.help=[a(1,"Drawing, counting, and procedures/methods",["DrawPause","OlympicRings1","OlympicRings2","ThePlough","ForLoop","Circles","NestedLoops","SimpleProcedure","ColourSpiral","ParameterProcedure","Polygons","YouAreHere"]),a(2,"Further commands and structures",["Stars","PolygonRings","Clock","DigitalClock","CycleColours","Triangles","Flashlights","RefParams","Balls3D","AskInput","StringFunctions","MathFunctions","TrigonometricGraphs"]),a(3,"Smooth movement and interaction",["MovingBall","BouncingBall","TurtleMove","TurtleBounce","MultiBounce","GravitySteps","SolarSystem","SimpleDraw","FiveTurtles"]),a(4,"Complex applications",["PaintApp","SnakeGame","Shoot","Mandelbrot","Quine","NoughtsAndCrosses"]),a(5,"Artificial life and social models",["GameOfLife","Schelling","IteratedPD"])],e.exports.csac=[a(1,"Introduction, Computer Science for Fun, and Turtling",["DrawPause","ColourSpiral"]),a(2,"Animation and Movement",["MovingBall","BouncingBall","TurtleMove","TurtleBounce","AskInput"]),a(3,"Computing in Physics: Cannons and Rockets",["GravitySteps","AimCannon","AutoCannon","Launch"]),a(4,"Cellular Automata: Modelling Disease, 'Life', and Shell Patterns",["LifeStart","Disease","GameOfLife","Automata"]),a(5,"Computing in Chemistry: Diffusion and Brownian Motion",["Diffusion","BrownianMotion"]),a(6,"Computing in Biology: Evolution and Behaviour",["Cheetahs","SexRatio","Flocking"]),a(7,"Chaos and Self-Similarity",["Logistic","LogisticSpider","Mandelbrot","MandelbrotMini","MandelbrotSpectrum","MandelbrotMiniSpectrum","Triangles","Sierpinski","SierpinskiDots","IFSBackground","SierpinskiColour","SierpinskiIFS","BarnsleyIFS","BarnsleyColour","TreeIFS","DragonIFS","DragonColour"]),a(8,"Waves and Quantum Mechanics",["Interference","WaveSuperposer","TwoSlits"]),a(9,"Games and Computer Science",["KnightsTour","Nim","NoughtsAndCrosses"]),a(10,"Philosophy and Social Science",["Schelling","IteratedPD"])],e.exports.names={AimCannon:"Firing a cannon (manual)",AskInput:"Asking for typed input",AutoCannon:"Firing a cannon (automatic)",Automata:"One-dimensional cellular automata",Balls3D:"3D colour effects",BarnsleyColour:"Barnsley colour",BarnsleyIFS:"Barnsley IFS",BouncingBall:"Bouncing ball (using variables)",BrownianMotion:"Brownian motion",Cheetahs:"Cheetahs and gazelles",Circles:"Circling circles",Clock:"Analogue clock (using REPEAT)",ColourSpiral:"Spiral of colours",CycleColours:"Cycling colours (using MOD)",Diffusion:"A model of diffusion",DigitalClock:"Digital clock (using IF and WHILE)",Disease:"Spread of disease",DragonColour:"Dragon colour",DragonIFS:"Dragon IFS",DrawPause:"Simple drawing with pauses",FiveTurtles:"Five turtles moving to the mouse",Flashlights:"Using Booleans",Flocking:"Flocking behaviour",ForLoop:"FOR (counting) loop",GameOfLife:"Conway's Game of Life",GravitySteps:"Movement under gravity",IFSBackground:"Iterated function systems (IFS) background",Interference:"Interference",IteratedPD:"Iterated Prisoner's Dilemma",KnightsTour:"Knight's tour",Launch:"Launching a rocket into orbit",LifeStart:"Initialising Conway's Game of Life",Logistic:"Logistic equation",LogisticSpider:"Logistic spider",Mandelbrot:"Mandelbrot set",MandelbrotMini:"Mandelbrot mini",MandelbrotMiniSpectrum:"Mandelbrot mini spectrum",MandelbrotSpectrum:"Mandelbrot spectrum",MathFunctions:"Mathematical functions",MovingBall:"Moving ball (using variables)",MultiBounce:"Multiple bouncing balls",NestedLoops:"Nested FOR loops",Nim:"Nim",NoughtsAndCrosses:"Noughts and crosses",OlympicRings1:"Olympic rings 1 (using PENUP)",OlympicRings2:"Olympic rings 2 (with variable)",PaintApp:"Painting application",ParameterProcedure:"Procedure with parameter",PolygonRings:"Polygon rings",Polygons:"POLYGON and POLYLINE",Quine:"Quine (self-replicating) program",RefParams:"Reference parameters",Schelling:"Schelling's segregation model",SexRatio:"The sex ratio",Shoot:"Arcade shooting game",Sierpinski:"Sierpinski triangle",SierpinskiColour:"Sierpinski colour",SierpinskiDots:"Sierpinski dots",SierpinskiIFS:"Sierpinski IFS",SimpleDraw:"Drawing to the mouse",SimpleProcedure:"Simple procedure",SnakeGame:"Snake (classic game)",SolarSystem:"Solar system (using ARRAY)",Stars:"Stars (using ANGLES and FORGET)",StringFunctions:"String functions",ThePlough:"The plough constellation",TreeIFS:"Tree IFS",Triangles:"Recursive triangles",TrigonometricGraphs:"Trigonometric graphs",TurtleBounce:"Bouncing ball (using the Turtle)",TurtleMove:"Moving ball (using the Turtle)",TwoSlits:"Young's two-slit experiment",WaveSuperposer:"Wave superposer",YouAreHere:"Text and arrow (using PRINT)"}},function(e,t,a){"use strict";a.d(t,"b",function(){return b}),a.d(t,"a",function(){return f});var n=a(1),r=a(4),o=a(3);const s=Object(n.a)("input",{type:"text",placeholder:"filename",on:[{type:"input",callback:e=>{Object(o.b)("set-name",e.currentTarget.value)}}]}),i=Object(n.a)("select",{content:r.f.map(e=>Object(n.a)("option",{content:e,value:e})),on:[{type:"change",callback:e=>{Object(o.b)("set-language",e.currentTarget.value)}}]}),l=Object(n.a)("button",{content:"RUN",classes:["tsx-run-halt-button"],on:[{type:"click",callback:e=>{Object(o.b)("machine-run-halt"),e.currentTarget.blur()}}]}),c=Object(n.a)("button",{content:"&#10074;&#10074;",classes:["tsx-play-pause-button"],on:[{type:"click",callback:e=>{Object(o.b)("machine-play-pause"),e.currentTarget.blur()}}]}),d=Object(n.a)("dd",{classes:["tsx-turtxy"],content:"500"}),u=Object(n.a)("dd",{classes:["tsx-turtxy"],content:"500"}),p=Object(n.a)("dd",{classes:["tsx-turtd"],content:"0"}),m=Object(n.a)("dd",{classes:["tsx-turttc"],content:"2"}),h=Object(n.a)("dd",{classes:["tsx-turttc"],style:"background:#000;"}),g=Object(n.a)("dl",{classes:["tsx-turtle-properties"],content:[Object(n.a)("dt",{content:"X"}),d,Object(n.a)("dt",{content:"Y"}),u,Object(n.a)("dt",{content:"D"}),p,Object(n.a)("dt",{content:"T"}),m,Object(n.a)("dt",{content:"C"}),h]}),b=Object(n.a)("div",{classes:["tsx-controls"],content:[s,i]}),f=Object(n.a)("div",{classes:["tsx-controls"],content:[l,c,g]});Object(o.a)("name-changed",e=>{s.value=e}),Object(o.a)("language-changed",e=>{i.value=e}),Object(o.a)("machine-started",()=>{l.innerHTML="HALT",c.innerHTML="&#10074;&#10074;",d.innerHTML="500",u.innerHTML="500",p.innerHTML="0",m.innerHTML="2",h.style.background="#000"}),Object(o.a)("machine-stopped",()=>{l.innerHTML="RUN",c.innerHTML="&#10074;&#10074;"}),Object(o.a)("machine-played",()=>{c.innerHTML="&#10074;&#10074;"}),Object(o.a)("machine-paused",()=>{c.innerHTML="&#9658;"}),Object(o.a)("turtx-changed",e=>{d.innerHTML=e.toString(10)}),Object(o.a)("turty-changed",e=>{u.innerHTML=e.toString(10)}),Object(o.a)("turtd-changed",e=>{p.innerHTML=e.toString(10)}),Object(o.a)("turtt-changed",e=>{m.innerHTML=e.toString(10)}),Object(o.a)("turtc-changed",e=>{h.style.background=Object(n.c)(e)})},,,,,function(e,t,a){"use strict";a.r(t);var n=a(8),r=a(1),o=Object(r.a)("div",{content:[Object(r.a)("h3",{content:"Turtle System X"}),Object(r.a)("p",{content:"This is a multi-platform version of the <i>Turtle System</i>. It is available for Windows, MacOS, and Linux, and can also be run directly in a web browser. It is written in JavaScript, and uses Node and Electron to create the downloadable desktop versions."}),Object(r.a)("p",{content:'The application is open source, and the source code can be viewed at <a href="https://github.com/oxfordturtle/turtlesystemx">https://github.com/oxfordturtle/turtlesystemx</a>.'}),Object(r.a)("p",{content:"This version is developed in tandem with the original version of the <i>Turtle System</i>, which is written in Delphi Pascal, and is available for download as a Windows desktop application. The original Delphi Pascal version is more powerful in some respects, and is faster at compiling and running very long or complicated programs. Windows users may therefore prefer to use that version."})]}),s=Object(r.a)("div",{content:[Object(r.a)("h3",{content:"The HTML5 Canvas API"}),Object(r.a)("p",{content:'The <em>Turtle System X</em> uses the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API">HTML5 Canvas API</a> for rendering the <em>Turtle Graphics</em> output of your programs. Because of the inherent nature of this API, it has not been possible to maintain complete consistency in the visual output of your programs between this version and the Delphi Pascal version avaiable for Windows. The following unavoidable differences remain:'}),Object(r.a)("ul",{content:[Object(r.a)("li",{content:'<b>Anti-aliasing</b> The HTML5 Canvas API makes its images appear smoother at the edges using a technique called "anti-aliasing". This means, for example, that when you draw a red blot on the Canvas, the pixels immediately surrounding that blot will be filled in using a semi-transparent red of the same shade. The Delphi Pascal <i>Turtle System</i> does not do this, giving your shapes sharper and more visibly "pixelated" edges. The most likely practical effect this difference will make to your programs concerns animations. To give the appearance of a red ball moving against a white background, for example, you need to draw a red blot, pause for a moment, then draw a white blot on top of it (to "blot it out"), immediately drawing another red blot in a slightly different position. To achieve this effect in the <i>Turtle System X</i>, the white blot needs to be slightly <em>larger</em> than the red blot. If it is not, the semi-transparent red pixels around the edges of your red ball will not be blotted out, and you will see a kind of "vapour trail" as the ball moves across the screen.'}),Object(r.a)("li",{content:'<b>Line drawing</b> A Canvas coordinate corresponds to the top left corner of a square pixel. A horizontal or vertical line from one coordinate to another is thus conceptually centered <em>in between</em> two pixels. If the thickness of the line is even, this causes no difficulty, as the same number of pixels can be filled in on either side. If the thickness of the line is odd, however, it is less obvious what should be done. The Delphi Pascal <i>Turtle System</i> fills in an extra pixel either to the right of or below the coordinate line, meaning that horizontal and vertical lines of odd-numbered thickness are centred half a pixel to the right or below their even-numbered counterparts. The HTML5 Canvas API, however, keeps lines of odd-numbered thickness exactly centred, giving the appearance of "half" pixels on either side using anti-aliasing (i.e. an extra pixel is filled in on <em>both</em> sides, but using a semi-transparent colour). At the default (very high) resolution, this will not make any noticeable difference to your programs. At lower resolutions, however, where each pixel is a visible square on the Canvas, the difference can be quite striking. To mitigate this, the <i>Turtle System X</i> artificially doubles the resolution of the Canvas when it is set to anything below 60 in either dimension (this setting can be changed or turned off entirely in the options tab). The effect of this is to eliminate any lines of odd-numbered thickness, since the actual output thickness will always be multiplied by 2. For an illustration of the problem this is designed to solve, you may like to disable this option, and then run the <i>Snake (classic game)</i> example program.'}),Object(r.a)("li",{content:"<b>Text underlining</b> The HTML5 Canvas API does not support underlined or crossed out text. Consequently attempts to print text like this to the Canvas in the <i>Turtle System X</i> will result in normal text being printed instead."})]})]}),i=Object(r.f)("tsx-system-tabs",[{label:"About",active:!0,content:[o]},{label:"Versions",active:!1,content:[s]}]),l=a(3);const c=document.getElementById("tsx");c.classList.add("tsx"),window.isElectron?document.body.parentElement.classList.add("tsx-electron"):document.body.parentElement.classList.add("tsx-browser"),c.classList.add("tsx-help"),c.appendChild(n.b),c.appendChild(i),Object(l.b)("ready")}]);